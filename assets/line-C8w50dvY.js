import{iC as g,iD as D,iE as F,iF as d,iG as p,iH as A,af as w,as as v,iI as z,iJ as E,iK as m,dc as y,iL as S}from"./index-ni2rzWLC.js";function $(t,e=!1){return t<=D?e?new Array(t).fill(0):new Array(t):g(t)}function q(t,e,n=null){const a=[],r=e.mapPositions,i=I(e,a),o=i.data,s=i.indices.length,u=F(s);return G(e,a,u),H(e,a,u),x(e,a,u),C(e,a,i.indices,u),R(e,a,i.indices,u),T(e,a),j(e,a,i.indices,u),J(e,a,o),new d(t,a,r,2,n)}function I(t,e){const{attributeData:{position:n},removeDuplicateStartEnd:a}=t,r=K(n)&&a,i=n.length/3-(r?1:0),o=new Array(2*(i-1)),s=r?n.slice(0,-3):n;let u=0;for(let l=0;l<i-1;l++)o[u++]=l,o[u++]=l+1;const c=new p(s,o,3,r);return e.push(["position",c]),c}function G(t,e,n){if(t.attributeData.colorFeature!=null)return;const a=t.attributeData.color;e.push(["color",new p(a??A,n,4)])}function x(t,e,n){t.attributeData.normal&&e.push(["normal",new p(t.attributeData.normal,n,3)])}function C(t,e,n,a){const r=t.attributeData.colorFeature;r!=null&&(typeof r=="number"?e.push(["colorFeatureAttribute",new p([r],a,1,!0)]):e.push(["colorFeatureAttribute",new p(r,n,1,!0)]))}function H(t,e,n){t.attributeData.sizeFeature==null&&e.push(["size",new p([t.attributeData.size??1],n,1,!0)])}function R(t,e,n,a){const r=t.attributeData.sizeFeature;r!=null&&(typeof r=="number"?e.push(["sizeFeatureAttribute",new p([r],a,1,!0)]):e.push(["sizeFeatureAttribute",new p(r,n,1,!0)]))}function T(t,e){const{attributeData:{position:n,timeStamps:a}}=t;if(!a)return;const r=n.length/3,i=new Array(2*(r-1));let o=0;for(let s=0;s<r-1;s++)i[o++]=s,i[o++]=s+1;e.push(["timeStamps",new p(a,i,h,!0)])}function j(t,e,n,a){const r=t.attributeData.opacityFeature;r!=null&&(typeof r=="number"?e.push(["opacityFeatureAttribute",new p([r],a,1,!0)]):e.push(["opacityFeatureAttribute",new p(r,n,1,!0)]))}function J(t,e,n){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==1||!t.overlayInfo.spatialReference.isGeographic)return;const a=w(n.length),r=v(t.overlayInfo.spatialReference);for(let f=0;f<a.length;f+=3)z(n,f,a,f,r);const i=n.length/3,o=E(i+1);let s=L,u=M,c=0,l=0;m(s,a[l++],a[l++]),l++,o[0]=0;for(let f=1;f<i+1;++f)f===i&&(l=0),m(u,a[l++],a[l++]),l++,c+=S(s,u),o[f]=c,[s,u]=[u,s];e.push(["distanceToStart",new p(o,e[0][1].indices,1,!0)])}function K(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const L=y(),M=y(),h=4;function P(t,e,n,a,r){if(t==null||t.length===0)return[];const i=[];return t.forEach((o,s)=>{const u=o.length,c=w(3*u);o.forEach((f,b)=>{c[3*b]=f[0],c[3*b+1]=f[1],c[3*b+2]=f[2]});const l={attributeData:{position:c,normal:e,colorFeature:n==null?void 0:n[s],opacityFeature:a==null?void 0:a[s],sizeFeature:r==null?void 0:r[s]},removeDuplicateStartEnd:!1};i.push(l)}),i}function B(t,e,n,a,r,i){if(t==null||t.length===0)return[];const o=P(t,e,a,r,i);return t.forEach((s,u)=>{const c=n==null?void 0:n[u],l=c!=null?U(c.timeStamps,c.streamlineType):void 0;o[u].attributeData.timeStamps=l}),o}function U(t,e){const n=$(t.length*h),a=t[0],r=t[t.length-1];for(let i=0;i<t.length;i++)n[i*h]=t[i],n[i*h+1]=a,n[i*h+2]=r,n[i*h+3]=e+.5;return n}export{B as E,P as S,q as f,$ as n};
