import{cf as $,aC as O,ee as z,ck as R,nM as E,c1 as F,nN as H,e8 as M,a9 as N,aa as _,ax as j,nk as y,cb as A,cE as b,hc as L,f0 as I,cJ as q,lF as P,_ as d,m as v,b as k}from"./index-5QWH35TG.js";import{l as B}from"./projectBoundingSphere-DGLxjKBQ.js";function Z(e,n,t,s){const i=$(n,s);if(i==null)return!1;const a=i.source.spatialReferenceId,o=i.dest.spatialReferenceId;if(a===o&&a!==0||O(n,s))return t[0]=1,t[1]=1,t[2]=1,!0;if(a===1){const c=z(e),p=c/Math.sqrt(e[0]*e[0]+e[1]*e[1]),r=c/R.radius;if(o===3)return t[0]=p*r,t[1]=p*r,t[2]=1,!0;if(o===2||o===5){const u=E;return t[0]=u*p*r,t[1]=u*r,t[2]=1,!0}}else if(a===11){if(o===2||o===5)return t[0]=E,t[1]=E,t[2]=1,!0;if(o===3){const c=e[1]/R.radius;return t[0]=1,t[1]=1/Math.cos(c),t[2]=1,!0}}return!1}let h=class extends F{constructor(e){super(e),this._tmpEvent=new H,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=new M(this.view.state.viewingMode),this._intersector.options.store=0,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){var e,n;return(n=(e=this.view)==null?void 0:e.elevationProvider)==null?void 0:n.spatialReference}getElevation(e,n,t,s){const i=this._renderCoordsHelper,a=N(l,e,n,t);if(!i.toRenderCoords(a,s,a))return j.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:o,_intersector:c,intersectionHandler:p}=this,r=o.fullExtent,u=r!=null&&Number.isFinite(r.xmin)&&Number.isFinite(r.xmax)&&Number.isFinite(r.ymin)&&Number.isFinite(r.ymax)&&Number.isFinite(r.zmin)&&Number.isFinite(r.zmax)?new y(r.zmin,r.zmax):o.elevationRange;if(u==null)return null;const f=o.elevationOffset,w=u.elevationRangeMin+f,C=u.elevationRangeMax+f,x=i.setAltitude(G,C,a),g=i.setAltitude(J,w,a);return c.reset(x,g,this.view.state.camera),p.intersect(c,null,x,g,null,!0),c.results.min.getIntersectionPoint(a)?i.getAltitude(a):null}getSphereElevationBounds(e,n){return B(e,n,S,this._renderSR),this._layerElevationSource.getElevationRange(S)}getRootElevationBounds(){const e=this.layerElevationSource.fullExtent;return e!=null&&e.hasZ?new y(e.zmin,e.zmax):null}notifyObjectsChanged(e){this.spatialReference&&(this._computeLayerExtent(n=>{for(const t of e)n(t)},this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}notifyObjectsChangedFunctional(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}notifyObjectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,n){b(n),this._expandExtent(e,n)}_computeLayerExtent(e,n){b(n),e(t=>{this._expandExtent(t,n)})}_expandExtent(e,n){const t=this.spatialReference;if(t==null||e==null)return;L(m,e.quaternion),m[12]=e.center[0],m[13]=e.center[1],m[14]=e.center[2];const s=e.halfSize;for(let i=0;i<8;++i)l[0]=1&i?s[0]:-s[0],l[1]=2&i?s[1]:-s[1],l[2]=4&i?s[2]:-s[2],q(l,l,m),this._renderCoordsHelper.fromRenderCoords(l,l,t),P(n,l,n)}};d([v({constructOnly:!0})],h.prototype,"layerElevationSource",void 0),d([v({constructOnly:!0})],h.prototype,"intersectionHandler",void 0),d([v({constructOnly:!0})],h.prototype,"view",void 0),d([v()],h.prototype,"spatialReference",null),h=d([k("esri.views.3d.layers.i3s.LayerElevationProvider")],h);const m=I(),S=A(0,0,0,0),l=_(),G=_(),J=_();class D{constructor(n,t,s,i,a){this.toMapSpace=n,this.transform=t,this.obb=s,this.geometry=i,this.elevationAlignable=a}}class Q{constructor(n,t){this.position=n,this.rotationScale=t,this.origin=void 0}}export{h as E,Q as a,Z as i,D as t};
