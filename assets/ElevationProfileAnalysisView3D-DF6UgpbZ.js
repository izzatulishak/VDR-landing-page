const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lengthOperator-DvkMMCVK.js","assets/index-fmuX7-Nm.js","assets/index-DJQSEjQf.css","assets/Point2D-DFGf8HqH.js","assets/Envelope2D-B_zpPshd.js","assets/ProjectionTransformation-BtO04N44.js","assets/Transformation2D-BUe9nOQ-.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/jsonConverter-BgE5K7q1.js","assets/apiConverter-C2XdJ4Ax.js"])))=>i.map(i=>d[i]);
import{f8 as le,s as nt,c as ot,bF as z,cS as W,gy as be,aL as Ie,gz as de,vc as at,a2 as ye,jS as rt,rb as lt,y as Oe,rf as ut,l_ as ct,bB as Ge,bH as Q,xi as pt,dE as ht,oz as dt,kO as mt,ct as yt,xj as vt,uV as ft,a0 as gt,I as _t,eS as wt,im as Pe,a1 as bt,_ as r,m as u,b as x,q as Z,K as P,U as ue,aa as Se,e7 as Pt,xk as Te,a9 as St,em as $t,xl as Et,ot as xt,as as Dt,e8 as Rt,eO as kt,xm as Ct,v8 as O,eT as ae,is as Me,N as R,eh as Vt,e as It,xn as Ot,a5 as Gt,eg as ze,jv as Tt,x as ve,jn as Mt,O as Le,da as qe,u as ne,c2 as zt,f as ee,xo as Lt,aS as qt,xp as Ae,bz as Ue,fj as At,cF as Ut,uo as Ht,up as Zt,aj as fe,xq as Ft,h as jt,mP as Nt,ek as pe,bY as Qt,mQ as $e,w as Wt,tQ as Bt,xr as Yt,hi as Kt,hl as Xt}from"./index-fmuX7-Nm.js";import{e as Jt}from"./AnalysisView3D-DQDZ9Qkb.js";import{R as ei,M as ti,b as ii,j as He}from"./euclideanLengthMeasurementUtils-C00EQuXt.js";import{b as si}from"./settings-CveAWVeQ.js";import{R as Ze}from"./OutlineVisualElement-8mFFZ6aG.js";import{l as Fe}from"./throttle-CPlLwfBD.js";import{j as ni}from"./createUtils-DPWwDnPy.js";import{e as oi}from"./getDefaultUnitForView-Jp7-qOjh.js";import{s as ai,d as ri}from"./SketchViewModel-ljKj-8i_.js";import"./utils-DIG-NgLE.js";import"./geometry2dUtils-DCKw3rrB.js";import"./geodeticLengthOperator-BvPwl_p2.js";import"./geodeticCurveType-CirnHLSB.js";import"./lineStippleUtils-C89mzWlO.js";import"./EngineVisualElement-rfHoQILZ.js";import"./VisualElement-DUwqAmcv.js";import"./LaserlinePath.glsl-B6Q_t478.js";import"./line-17OFi9Ex.js";import"./line-BwcFC4NH.js";import"./triangulationUtils-DAjSAtvl.js";import"./earcut-D9gy186-.js";import"./deduplicate-DW3SJ3ds.js";import"./distanceOperator-CIgo1npM.js";import"./Point2D-DFGf8HqH.js";import"./Distance2DCalculator-CXhBP-8I-DVMppLH0.js";import"./ProjectionTransformation-BtO04N44.js";import"./Envelope2D-B_zpPshd.js";import"./Transformation2D-BUe9nOQ-.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./apiConverter-C2XdJ4Ax.js";import"./jsonConverter-BgE5K7q1.js";import"./simplifyOperator-BlSWAnZo.js";import"./operatorSimplify-BQGcwuk8.js";import"./mat2d-D9BceDIF.js";import"./mat2df64-DFLy2zOC.js";import"./SketchOptions-B7pKsQjj.js";import"./automaticAreaMeasurementUtils-Dv2LyIJB.js";import"./geodesicAreaMeasurementUtils-BcHCGpLr.js";import"./automaticLengthMeasurementUtils-BcUxihWJ.js";function E(e,t){let i,s=!1;function n(...a){const o=e.apply(this,a);return s&&i!==void 0&&(t!=null&&t(i,o))?i:(s=!0,i=o,o)}return n}function je(e){var t,i;return((i=(t=e==null?void 0:e.map)==null?void 0:t.allLayers)==null?void 0:i.toArray().filter(s=>(s.type!=="graphics"||!s.internal)&&s.visible).map(s=>s.uid))??[]}let Ne={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:Ne.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:le(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function H(){return Ne}const li={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};let ie=class extends nt{constructor(t,i,s){super(t,i,s),this.name="unknown",this.name=t}},re=class extends ie{constructor(){super("too-complex","The input geometry has too many points.")}},Qe=class extends ie{constructor(){super("invalid-geometry","The input geometry is invalid.")}};class ui extends ie{constructor(){super("elevation-query-error","Error querying elevation from provider.")}}let ci=class extends ie{constructor(){super("unknown","Unknown error.")}};async function pi(e,t,i,s,n,a,o){let l,c,p;const h=e.spatialReference,d=h.isGeographic||h.isWebMercator;let m=0;if(!d){const{execute:f}=await ot(()=>import("./lengthOperator-DvkMMCVK.js").then(_=>_.l),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]));z(o),m=f(e,{unit:"meters"}),z(o)}const y=1/W(s);if(d){await be([{source:h,dest:s},{source:h,dest:Ie.WGS84}],o);const f=Ei(e);l=ei([f],"meters")[0];const _=Ee(l,n);if(Re(e,l,_)>a)throw new re;const v=xe(f,t,i);({densifiedPath:c,distances:p}=gi(v,_,y)),c=de(c,s)}else{await be([{source:h,dest:s}],o),l=m;const f=Ee(l,n);if(Re(e,l,f)>a)throw new re;const _=xe(e,t,i);({densifiedPath:c,distances:p}=fi(_,f,y)),z(o),c=de(c,s)}return{densifiedPath:c,pathLength:l*y,distances:p}}function Ee(e,t){const i=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,i)}function xe(e,t,i){if(t==null)return De(e);const s=e.spatialReference,n=t.mode,a=at(t,s);let o=null;switch(i.type){case"2d":o=hi(e,n,a);break;case"3d":o=di(e,n,a,i)}return o==null?De(e):new ye({hasZ:!0,hasM:!1,spatialReference:s,paths:We(e.paths,o)})}function hi({hasZ:e},t,i){return t==="absolute-height"?e?([s,n,a])=>[s,n,a+i]:([s,n])=>[s,n,i]:null}function di({spatialReference:e,hasZ:t},i,s,{elevationProvider:n}){const a=(o,l,c,p)=>(n==null?void 0:n.getElevation(o,l,c,e,p))??0;switch(i){case"on-the-ground":return([o,l])=>[o,l,a(o,l,0,"ground")];case"absolute-height":return t?([o,l,c])=>[o,l,c+s]:([o,l])=>[o,l,s];case"relative-to-ground":return t?([o,l,c])=>[o,l,c+a(o,l,c,"ground")+s]:([o,l])=>[o,l,a(o,l,0,"ground")+s];case"relative-to-scene":return t?([o,l,c])=>[o,l,c+a(o,l,c,"scene")+s]:([o,l])=>[o,l,a(o,l,0,"scene")+s];default:return null}}function De(e){return e.hasZ?new ye({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:We(e.paths,([t,i])=>[t,i])}):e}function We(e,t){const i=e.length,s=new Array(i);for(let n=0;n<i;++n){const a=e[n],o=a.length,l=new Array(a.length);s[n]=l;for(let c=0;c<o;++c)l[c]=t(a[c])}return s}function Be(e){return ge(e)&&e.paths.some(t=>t.length>1)}function mi(e){return yi(e)&&Be(e.geometry)}function yi(e){return Ye(e)&&ge(e==null?void 0:e.geometry)}function ge(e){return!Ye(e)&&e!=null&&e.type==="polyline"}function Ye(e){return e!=null&&"geometry"in e}function vi(e){const t=e==null?void 0:e.layer;return t!=null&&t.type==="graphics"&&t.internal}function Ke(e,t,i,s,n){const{spatialReference:a,hasZ:o}=e,l={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:a,metersPerSR:W(a)},c=[],p=[];let h=0;for(let d=0;d<e.paths.length;++d){const m=e.paths[d],y=new Array,f=new Array;let _=0;for(let v=1;v<m.length;++v){const w=m[v-1],D=m[v],$=s(l,w,D);let k;for(k=_;k<$.distance&&!rt(k,$.distance);k+=t)y.push(n($,k)),f.push((h+k)*i);_=k-$.distance,h+=$.distance,y.push(D),f.push(h*i)}c[d]=y,p[d]=f}return{densifiedPath:new ye({spatialReference:a,hasZ:o,paths:c}),distances:p}}function fi(e,t,i){const{hasZ:s}=e;return Ke(e,t,i,wi,s?$i:Si)}function gi(e,t,i){const{hasZ:s}=e;return Ke(e,t,i,_i,s?Pi:bi)}function _i(e,t,i){return e.distance=0,ii(e,t,i,e.spatialReference),e.from=t,e.to=i,e}function wi(e,t,i){return e.from=t,e.to=i,e.distance=lt(i,t)*e.metersPerSR,e}function bi({from:e,azimuth:t,spatialReference:i},s){return He([0,0],e,t,s,i)}function Pi({from:e,to:t,azimuth:i,distance:s,spatialReference:n},a){const o=a/s,l=[0,0,Oe(e[2],t[2],o)];return He(l,e,i,a,n),l}function Si({from:e,to:t,distance:i},s){return ut([0,0],e,t,s/i)}function $i({from:e,to:t,distance:i},s){return ct([0,0,0],e,t,s/i)}function Ei(e){return ti(e.spatialReference)?e:de(e,Ie.WGS84)}function Xe(e){return e.paths.reduce((t,i)=>t+i.length,0)}function Re(e,t,i){return Xe(e)+Math.floor(t/i)+Math.max(0,e.paths.reduce(s=>1+s,0)-1)}function xi(e,t){const i=e.length;if(i===0)return null;const s=e[0],n=s.sampledZ;let a=n,o=n,l=0,c=0,p=null,h=null,d=n??0,m=0,y=0,f=n!=null?1:0,_=0,v=0;const w=W(t),D=Q(t),$=H().minSlopeSampleDistance/w,k=2*$,L=new ke,G=new ke,ce=()=>{st(),L.copy(G),G.reset()},we=(C,X)=>{ce(),C>0&&C-L.start<=k&&(C=L.start+$),G.restart(C,X)},st=()=>{if(L.isHole||G.isHole)return;const C=G.avgElevation-L.avgElevation,X=G.start-L.start,J=C*D,q=X*w,A=le(Math.atan2(J,q),"radians","degrees");A>0?(m+=A,p=U(p,A),_++):A<0&&(y-=A,h=U(h,-A),v++)};s.sampledZ!=null&&we(s.distance,s.sampledZ);for(let C=1;C<i;++C){const X=e[C-1],J=e[C],q=J.sampledZ;if(q==null){G.isHole||ce();continue}f++,d+=q,a=_e(a,q),o=U(o,q),G.isHole||J.distance-G.start>=$?we(J.distance,q):G.insert(q);const A=X.sampledZ;if(A!=null){const se=q-A;se>0?l+=se:se<0&&(c-=se)}}return ce(),f===0?null:{maxDistance:e[i-1].distance,minElevation:a,maxElevation:o,avgElevation:f===0?null:d/f,elevationGain:l,elevationLoss:c,maxPositiveSlope:p,maxNegativeSlope:h,avgPositiveSlope:_===0?null:m/_,avgNegativeSlope:v===0?null:y/v}}function Di(e){const t=e.filter(Ge),i=t.length;if(i===0)return null;const s=t[0];if(i===1)return s;let n=s.maxDistance,a=s.minElevation,o=s.maxElevation,l=s.maxPositiveSlope,c=s.maxNegativeSlope;for(let p=1;p<t.length;++p){const h=t[p];n=U(n,h.maxDistance),a=_e(a,h.minElevation),o=U(o,h.maxElevation),l=U(l,h.maxPositiveSlope),c=U(c,h.maxNegativeSlope)}return{maxDistance:n,minElevation:a,maxElevation:o,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:l,maxNegativeSlope:c,avgPositiveSlope:null,avgNegativeSlope:null}}function Ri(e){let t=null,i=null,s=null;for(const n of e){if(n==null)continue;const{statistics:a,spatialReference:o}=n;if(a==null)continue;const l=W(o);t=U(t,he(a.maxDistance,l));const c=Q(o);s=_e(s,he(a.minElevation,c)),i=U(i,he(a.maxElevation,c))}return{minDistance:0,maxDistance:t??0,minElevation:s??0,maxElevation:i??0}}function _e(e,t){return t==null?e:e!=null?Math.min(e,t):t}function U(e,t){return t==null?e:e!=null?Math.max(e,t):t}function he(e,t){return e!=null&&t!=null?e*t:null}let ke=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(t,i){this._start=t,this._sampleCount=1,this._totalElevation=i}insert(t){++this._sampleCount,this._totalElevation+=t}};function ki(e,t,i=[]){if(e>=t||(i.push(e),t-e<2))return i;const s=t-1;i.push(s);const n=me(e+1,s);for(;;){const a=n.next();if(a.done)break;i.push(a.value)}return i}function*me(e,t){if(e>=t)return;const i=e+Math.floor((t-e)/2);yield i;const s=me(e,i),n=me(i+1,t);for(;;){const a=s.next(),o=n.next();if(a.done&&o.done)break;a.done||(yield a.value),o.done||(yield o.value)}}async function*Ci(e,t){const{view:i,geometry:s,elevationInfo:n,providers:a,options:o}=e,l=i.spatialReference;if(!l||s==null||!Be(s))throw new Qe;const c=a.length;if(c===0)return null;const p=Math.round(o.maxTotalSamples/c);if(Xe(s)>p)throw new re;const h=await pi(s,n,i,l,o,p,t);z(t);let d=0;const m=new Array(c),y=new Array(c);for(let v=0;v<c;v++){const w=Mi(h);m[v]=w,d+=w.samples.length;const D={...e,provider:a[v],result:w,densificationResult:h};y[v]=Vi(D,t)[Symbol.iterator]()}if(d>o.maxTotalSamples)throw new re;const f=await Promise.all(y.map(v=>{const w=v.next();return w.done===!0?Promise.resolve(null):w.value}));z(t);for(let v=0;v<c;v++)m[v]=f[v];yield m,await mt(e.delayAfterPreview??H().delayAfterPreviewMillis,null,t.signal),z(t);const _=[];try{let v;do{v=!1;for(let w=0;w<c;w++){const D=y[w].next();D.done===!1&&(_.push({resultPromise:D.value,index:w}),v=!0)}}while(v)}finally{y.forEach(v=>{var w;return(w=v.return)==null?void 0:w.call(v)})}for(const{resultPromise:v,index:w}of _)m[w]=await v,z(t),yield m;for(const v of m)v!=null&&(v.progress=1);yield m}function*Vi(e,t){const{densificationResult:i}=e,s={...e,abortOptions:t,densificationResult:i},n=ki(0,s.result.samples.length),a=n.slice(0,s.provider.numSamplesForPreview);yield Ce(s,a,!0);const o=ft(n,s.provider.numSamplesPerChunk);for(const l of o)yield Ce(s,l,!1)}async function Ce({densificationResult:e,result:t,provider:i,queue:s,abortOptions:n,cache:a},o,l){const{densifiedPath:c,pathLength:p}=e,h=t.spatialReference,{samples:d}=t,m=[];for(let y=0;y<o.length;y++){const f=d[o[y]];m[y]=[...f.coordinate]}try{return await s.push({geometry:new gt({spatialReference:h,points:m,hasZ:c.hasZ}),provider:i,indices:o,preview:l,result:t,parameters:{...H().defaultQueryOptions(),minDemResolution:Math.round(l?p/i.numSamplesForPreview:p/d.length),cache:a}},n),{...t}}catch(y){return _t(y)?null:li}}function Ii(e){return new pt({priority:ht.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async t=>{z(t.parameters);try{await Oi(t)}catch(i){dt(i)}}})}async function Oi({geometry:e,provider:t,indices:i,preview:s,result:n,parameters:a}){if(i.length===0)return;const o=(await qi(t,e,a)).geometry,{hasZ:l,points:c}=o,p=a.noDataValue,{samples:h}=n;for(let d=0;d<i.length;d++){const m=h[i[d]];if(m.isHole)continue;const y=l?c[d][2]:null;y===null||y===p?m.sampledZ=null:(n.hasZ=!0,m.sampledZ=y),m.sampled=!0}Gi(h),n.progress=s?0:n.progress+i.length/h.length,n.statistics=xi(n.samples,n.spatialReference)}function Gi(e){const t=e.length-1;let i=0;for(let s=1;s<=t;s++)(e[s].sampled||s===t)&&(Ti(e,i,s),i=s)}function Ti(e,t,i){if(i-t===1)return;const s=e[t],n=s.sampledZ,a=e[i],o=a.sampledZ;if(n==null||o==null){for(let p=t+1;p<i;p++)e[p].sampledZ=null;return}const l=s.distance,c=a.distance-l;for(let p=t+1;p<i;p++){const h=e[p],d=(h.distance-l)/c;h.sampledZ=Oe(n,o,d)}}function Mi({densifiedPath:e,distances:t}){const i=e.spatialReference,s=yt(i),n=e.paths,a=n.length,o=[];let l=null,c=0;for(let p=0;p<a;p++){const h=n[p],d=h.length,m=t[p];for(let y=0;y<d;y++){const f=h[y],_=m[y];s&&(f[0]=vt(f[0],s.valid[0],s.valid[1])),l&&y===0&&zi(o,l,f,c,_),o.push(Li(f,_)),l=f,c=_}}return{progress:0,samples:o,hasZ:!1,statistics:null,spatialReference:i}}function zi(e,t,i,s,n){e.push(Ve(t,s)),e.push(Ve(i,n))}function Li(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function Ve(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function qi(e,t,i){try{return await e.queryElevation(t,i)}catch{throw new ui}}function Ai(e,t,i){if(!e||e.length===0)return;const s=e.length-1,n=e[0];if(t<=i(n))return n;const a=e[s];if(t>=i(a))return a;let o=0,l=0,c=s;for(;o<c;){l=o+Math.floor((c-o)/2);const p=e[l],h=i(p);if(h===t)return p;if(t<h){if(l>0){const d=e[l-1],m=i(d);if(t>m)return t-m>=h-t?p:d}c=l}else{if(l<s){const d=e[l+1],m=i(d);if(t<m)return t-h>=m-t?d:p}o=l+1}}return e[l]}function Je(e){return e>.999999?1:e}function Ui(e,t){if(e==null||t==null)return null;const{samples:i,spatialReference:s}=e,{distance:n,elevation:a}=t,o=W(s),l=Q(s),c=i.length,p=new Array(c);for(let h=0;h<c;++h){const d=i[h],m=d.sampledZ,y=d.coordinate;p[h]={x:y[0],y:y[1],z:m,distance:et(d.distance,o,n),elevation:B(m,l,a)}}return p}function Hi(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;const{distance:i,elevation:s}=t,{statistics:n,spatialReference:a}=e,o=W(a),l=Q(a);return{maxDistance:et(n.maxDistance,o,i),minElevation:B(n.minElevation,l,s),maxElevation:B(n.maxElevation,l,s),avgElevation:B(n.avgElevation,l,s),elevationGain:B(n.elevationGain,l,s),elevationLoss:B(n.elevationLoss,l,s),maxPositiveSlope:n.maxPositiveSlope,maxNegativeSlope:n.maxNegativeSlope,avgPositiveSlope:n.avgPositiveSlope,avgNegativeSlope:n.avgNegativeSlope}}function et(e,t,i){return e==null?null:le(e*t,"meters",i)}function B(e,t,i){return e==null?null:le(e*t,"meters",i)}let V=class extends wt{constructor(t){super(t),this._getSamplesMemoized=Pe((i,s)=>Ui(i,s)),this._getStatisticsMemoized=Pe((i,s)=>Hi(i,s)),this.rawResult=null}get available(){const{computation:t}=this;return t.profile.enabled&&t.available}get profile(){return this.computation.profile}get progress(){return Je(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;const t=this.computation.controller.analysisViewData.hoveredPosition;if(t==null)return null;const{rawResult:i,samples:s}=this;if(s==null||i==null)return null;const n=s.length;if(n===0)return null;const a=s[n-1].distance,o=Ai(s,t*a,h=>h.distance);if(o==null)return null;const{x:l,y:c,z:p}=o;return p==null?null:new bt({x:l,y:c,z:p,spatialReference:i.spatialReference})}};r([u()],V.prototype,"available",null),r([u({readOnly:!0})],V.prototype,"profile",null),r([u({readOnly:!0})],V.prototype,"progress",null),r([u()],V.prototype,"samples",null),r([u()],V.prototype,"statistics",null),r([u({constructOnly:!0})],V.prototype,"computation",void 0),r([u()],V.prototype,"rawResult",void 0),r([u()],V.prototype,"hoveredPoint",null),V=r([x("esri.views.analysis.ElevationProfile.ElevationProfileResult")],V);let S=class extends Z{constructor(e){super(e),this.result=new V({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([P(()=>{const{geometry:e,elevationInfo:t}=this.controller.analysis;return[e,t]},()=>this.onInvalidate(this),ue)])}setResult(e){this.result.rawResult=e}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return H().defaultDemResolution}};r([u({constructOnly:!0})],S.prototype,"controller",void 0),r([u({constructOnly:!0})],S.prototype,"profile",void 0),r([u({constructOnly:!0})],S.prototype,"onInvalidate",void 0),r([u()],S.prototype,"result",void 0),r([u({readOnly:!0})],S.prototype,"progress",null),r([u()],S.prototype,"hoveredPoint",null),r([u()],S.prototype,"available",null),r([u()],S.prototype,"numSamplesForPreview",void 0),r([u()],S.prototype,"numSamplesPerChunk",void 0),r([u({readOnly:!0})],S.prototype,"minDemResolution",null),S=r([x("esri.views.analysis.ElevationProfile.ElevationProfileLineComputation")],S);const Zi=2e5;let T=class extends S{constructor(){super(...arguments),this.type="scene",this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getStableElevationDependencies=E(()=>{var i;const t=this._view;return t?{view:t,stationary:t.stationary,geometry:(i=this.controller)==null?void 0:i.analysis.geometry,visibleLayerIds:this._getStableLayerIds(),maxIntersectionDistance:this._maxIntersectionDistance,intersectOptions:this._intersectOptions,spatialReference:this._getStableSpatialReference()}:null},O),this._getStableSpatialReference=E(()=>{var t;return(t=this._view)==null?void 0:t.spatialReference},ae),this._getStableLayerIds=E(()=>je(this._view),O),this._getStablePointCloudLayers=E(()=>{const t=this._view;return t?t.allLayerViews.toArray().filter(i=>{var s;return((s=i.layer)==null?void 0:s.type)==="point-cloud"}).map(i=>i.layer):[]},O),this._vecA=Se(),this._vecB=Se(),this._ray=Pt()}get minDemResolution(){var s,n;const t=this._view;if(!t)return null;const i=(n=(s=t.pointsOfInterest)==null?void 0:s.focus)==null?void 0:n.worldUnitsPerContentPixel;return i==null?null:i*Q(t.spatialReference)}initialize(){const t=()=>this.onInvalidate(this);return this.addHandles([P(()=>this._queryElevationDependencies,t,ue),this.controller.onElevationChange(t)])}async queryElevation(t,{noDataValue:i,signal:s}){const n=this._queryElevationDependencies;if(n==null)throw new Error(`${this.declaredClass}: no dependencies`);const a=this._intersector;if(a==null)throw new Error(`${this.declaredClass}: no view`);const{intersectOptions:o,view:l,spatialReference:c}=n,p=l.renderCoordsHelper,h=l.sceneIntersectionHelper,d=this._vecA,m=this._vecA,y=this._vecB,f=this._ray;if(!c)return{geometry:t,noDataValue:i};const _=await Te.fromGeometry(t).project(c,s);if(!_)return{geometry:t,noDataValue:i};const v=_.coordinates,w=v.length;for(let D=0;D<w;++D){const $=v[D];St(y,$.x,$.y,$.z??0),p.toRenderCoords(y,c,y),p.setAltitude(d,Zi,y);const k=$t(d,y,f);h.computeIntersection(k,a,!0,o);const L=Fi(n,a.results.all);L?(L.getIntersectionPoint(m),p.fromRenderCoords(m,m,c),$.z=m[2]):$.z=i}return{geometry:_.export(),noDataValue:i}}get _queryElevationDependencies(){return this._getStableElevationDependencies()}get _intersectOptions(){const t=this._view;if(!t||t.destroyed)return{};const{include:i,exclude:s}=this.profile;return Et(t,{include:i,exclude:[...this._pointCloudLayers,...xt(s)?s:s?[s]:[]]})}get _pointCloudLayers(){return this._getStablePointCloudLayers()}get _view(){const t=this.controller.view;return t.type==="3d"?t:null}get _maxIntersectionDistance(){const t=this._view;return t!=null&&t.renderCoordsHelper?Dt(t.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const t=this._view;if(!t)return null;const i=new Rt(t.state.viewingMode),s=i.options;return s.hud=!1,s.invisibleTerrain=!1,s.backfacesTerrain=!1,s.selectionMode=!1,s.store=2,i}};function Fi({intersectOptions:e,maxIntersectionDistance:t,view:i},s){const n=e.graphics,a=!(!(n!=null&&n.include)&&!(n!=null&&n.exclude));for(const o of s)if(o.withinDistance(t)){if(a){const l=kt(o,i);if(l!=null&&!Ct(n,l))continue}return o}return null}r([u({readOnly:!0})],T.prototype,"minDemResolution",null),r([u()],T.prototype,"_queryElevationDependencies",null),r([u()],T.prototype,"_intersectOptions",null),r([u()],T.prototype,"_pointCloudLayers",null),r([u()],T.prototype,"_view",null),r([u()],T.prototype,"_maxIntersectionDistance",null),r([u()],T.prototype,"_intersector",null),T=r([x("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineSceneComputation")],T);function ji(e){return Me([P(()=>{const{analysis:t,sketchGraphic:i,toolState:s,visible:n}=e.analysisViewData,{geometryVisualizationVisible:a}=t.viewOptions;return{geometryVisualizationVisible:a,geometry:t.geometry,sketchGraphic:i,toolState:s,visible:n}},({geometryVisualizationVisible:t,sketchGraphic:i,toolState:s,visible:n})=>{if(e.remove(),n)return t&&i!=null&&s!=="reshaping"&&s!=="sketching"?e.show(i):void 0},R)])}let Y=class extends Z{constructor(t){super(t),this._visualElementHandle=null}initialize(){this._settings=new si({getTheme:()=>this.view.effectiveTheme}),this.addHandles(ji({analysisViewData:this.analysisViewData,remove:()=>this._remove(),show:t=>this._show(t)}))}destroy(){this._remove()}get updating(){return!1}_remove(){this._visualElementHandle=Vt(this._visualElementHandle)}_show(t){this._remove();const{view:i}=this,s=new Ze({view:i,geometry:this.analysisViewData.analysis.geometry,attached:!1,renderOccluded:8,isDecoration:!0}),n=[P(()=>this.analysisViewData.analysis.elevationInfo,a=>{s.elevationInfo=a,s.isDraped=Ot(!0,a)==="on-the-ground"},R),P(()=>this.analysisViewData.analysis.geometry,a=>{s.geometry=a}),i.maskOccludee(t),It(s)];this._settings.visualElements.lineObjects.outline.apply(s),s.attached=!0,this._visualElementHandle=Me(n)}};r([u({constructOnly:!0})],Y.prototype,"view",void 0),r([u({constructOnly:!0})],Y.prototype,"analysisViewData",void 0),r([u()],Y.prototype,"updating",null),Y=r([x("esri.views.3d.analysis.ElevationProfile.ElevationProfileGeometryVisualization3D")],Y);function Ni(e,t){e??(e=[]);const i=e.length-1,s=[];let n=[];for(let a=0;a<=i;a++){const{x:o,y:l,z:c}=e[a];c!=null&&n.push([o,l,c]),a!==i&&c!=null||!n.length||(s.push(n),n=[])}return ni(s,t,!0)}let M=class extends Z{constructor(e){super(e),this._updateGeometryThrottled=Fe(t=>{if(!t)return;const{samples:i,spatialReference:s}=t,n=i!=null&&i.length>0;this._visualElement.geometry=n?Ni(i,s):null},H().profileLinesUpdateThrottleMillis)}initialize(){this._visualElement=new Ze({view:this.view,elevationInfo:ze,innerWidth:0,innerColor:Gt(0,0,0,0),width:3,falloff:0,renderOccluded:16,isDecoration:!0}),this.addHandles([P(()=>{var e;return{color:(e=this._result)==null?void 0:e.computation.profile.color,visible:this._effectiveVisible}},({color:e,visible:t})=>{e&&(this._visualElement.color=Tt(ve.toUnitRGBA(e))),this._visualElement.visible=t},R),P(()=>this.analysisViewData.analysis.geometry,()=>{this._visualElement.geometry=null},R),P(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),R),this._updateGeometryThrottled])}destroy(){this._visualElement.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){return this.getResult()}get _effectiveVisible(){const{analysisViewData:e,_result:t}=this;return e.visible&&t!=null&&t.available&&t.computation.profile.viewOptions.lineVisible}get _geometryUpdateParameters(){var e;return this._effectiveVisible&&this.analysisViewData.progress!==1?null:{samples:(e=this._result)==null?void 0:e.samples,spatialReference:this.view.spatialReference}}};r([u()],M.prototype,"view",void 0),r([u()],M.prototype,"analysisViewData",void 0),r([u()],M.prototype,"getResult",void 0),r([u()],M.prototype,"updating",null),r([u()],M.prototype,"_result",null),r([u()],M.prototype,"_effectiveVisible",null),r([u()],M.prototype,"_geometryUpdateParameters",null),M=r([x("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineVisualization3D")],M);let F=class extends Z{constructor(t){super(t),this.position=null,this.color=new ve("#ffffff"),this.element=Qi()}initialize(){var t;this.addHandles([P(()=>this._screenLocation,i=>{i&&(this.element.style.transform=`translate(${i.x}px, ${i.y}px)`)},R),P(()=>this.color.toCss(),i=>{this.element.style.background=i},R)]),(t=this.view.surface)==null||t.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){const{position:t,view:i}=this;i.type==="3d"?(i.commitProperty("size"),i.commitProperty("camera")):i.commitProperty("center");const s=i==null?void 0:i.spatialReference,n=s?Mt(t,s).geometry:null;return n&&(i!=null&&i.ready)?i.toScreen(n):null}};function Qi(){const e=document.createElement("div"),{size:t,borderStyle:i,borderColor:s,borderWidth:n,boxShadow:a}=H().hoveredPointsStyle,{style:o}=e;return o.display="block",o.position="absolute",o.top="0",o.left="0",o.contain="strict",o.boxSizing="border-box",o.width=`${t}px`,o.height=`${t}px`,o.marginTop=`-${t/2}px`,o.marginLeft=`-${t/2}px`,o.border=`${i} ${n}px ${s}`,o.borderRadius=`${t}px`,o.boxShadow=a,e}r([u()],F.prototype,"position",void 0),r([u({type:ve})],F.prototype,"color",void 0),r([u()],F.prototype,"view",void 0),r([u()],F.prototype,"_screenLocation",null),F=r([x("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization")],F);let j=class extends Z{constructor(t){super(t),this._hoveredPoints=new Le}initialize(){const{analysisViewData:t}=this,{analysis:i}=t;this.addHandles([P(()=>{const{hoveredPoints:s,visible:n,updating:a}=t;return n?a?null:s.map((o,l)=>{const c=i.profiles.at(l);return(c==null?void 0:c.viewOptions.hoveredPointVisible)===!0&&o!=null?{hoveredPoint:o,color:c.color}:null}).filter(o=>!!o):[]},s=>this._update(s),R),P(()=>i.geometry,()=>this._update([]),R)])}destroy(){this._hoveredPoints.drain(t=>t.destroy())}get updating(){return!1}_update(t){var a;if(!t)return;const{view:i,_hoveredPoints:s}=this,n=t.length;for(;s.length>n;)(a=s.pop())==null||a.destroy();for(;s.length<n;){const o=new F({view:i});s.push(o)}for(let o=0;o<n;++o){const l=t[o],c=s.at(n-1-o);c.position=l.hoveredPoint,c.color=l.color}}};r([u()],j.prototype,"view",void 0),r([u()],j.prototype,"analysisViewData",void 0),r([u()],j.prototype,"_hoveredPoints",void 0),r([u()],j.prototype,"updating",null),j=r([x("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization")],j);let K=class extends Z{constructor(e){super(e)}initialize(){const{view:e,analysisViewData:t}=this;this._hoveredPointsVisualization=new j({view:e,analysisViewData:t}),this._geometryVisualization=new Y({view:e,analysisViewData:t}),this._lineVisualizations=qe(()=>this.analysisViewData.analysis.profiles,i=>new M({view:e,analysisViewData:t,getResult:()=>t.results.find(s=>s.computation.profile===i)}))}destroy(){this._geometryVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualizations.destroy()}get updating(){return this._geometryVisualization.updating||this._lineVisualizations.some(e=>e.updating)}};r([u()],K.prototype,"view",void 0),r([u()],K.prototype,"analysisViewData",void 0),r([u()],K.prototype,"updating",null),K=r([x("esri.views.3d.analysis.ElevationProfile.ElevationProfileVisualization3D")],K);let g=class extends Z{constructor(e){super(e),this.error=null,this._getStableEffectiveUnits=E(()=>{const t=Ri(this._activeComputations.map(n=>n.result.rawResult)),i=this.analysis.displayUnits,s=oi(this.view);return{distance:Zt(t.maxDistance,"meters",i.distance??s),elevation:Ht(t.maxElevation,"meters",i.elevation??s)}},O),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=E(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),O),this._getStableGenerationParameters=E(()=>{const{view:t,analysis:i}=this;return t!=null&&t.ready&&this._queue?{view:t,geometry:i.geometry,geometryIsValid:i.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:t.type==="3d"?t.slice.plane:null}:null},O),this._getStableElevationInfo=E(()=>this.analysis.elevationInfo??Wi,ae),this._getStableOptions=E(()=>{const{densificationMaxSamples:t,defaultDemResolution:i,maxTotalSamples:s}=H();let n=this._minDemResolution??i;return n=parseFloat(n.toFixed(2)),{samplingDistance:n,densificationMaxSamples:Math.round(t/this._activeComputations.length),maxTotalSamples:s}},O),this._updateThrottled=Fe(t=>this._update(t),H().updateThrottleMillis)}initialize(){this._computationsCollection=qe(()=>this.analysis.profiles,t=>this.computationFactory.create({controller:this,profile:t,onInvalidate:i=>this._invalidateComputation(i)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on("change",()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),P(()=>this._updateParameters,t=>this._updateThrottled(t),R),this._updateThrottled]);const e=this.view.type==="3d"?this.view.resourceController:void 0;this._queue=Ii(e==null?void 0:e.scheduler),e==null||e.addUpdatingObject(this)}destroy(){var e;this._abortUpdate(),this._parametersPerComputation.clear(),(e=this._computationsCollection)==null||e.destroy(),this._queue=ne(this._queue),this._currentTileCache=ne(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let e=0,t=0;for(const i of this._activeComputations)e++,t+=i.progress;return Je(e>0?t/e:0)}get updating(){var n;const{progress:e}=this,t=!!((n=this._queue)!=null&&n.updating),i=this._updateThrottled.hasPendingUpdates(),s=this._updateTask!=null&&!this._updateTask.finished;return t||i||s||e>0&&e<1}get results(){return this._computations.map(e=>e.result)}get statistics(){return Di(this._activeComputations.map(e=>e.result.statistics))}get hoveredPoints(){return this._computations.map(e=>e.hoveredPoint)}onElevationChange(e){const{view:t}=this;return(t==null?void 0:t.type)==="3d"?zt(()=>t.elevationProvider,"elevation-change",e,{onListenerAdd:e,onListenerRemove:e}):ee()}get _tileCache(){var t;this._currentTileCache=ne(this._currentTileCache);const e=this.view;if((e==null?void 0:e.type)==="3d"){const i=(t=e.basemapTerrain)==null?void 0:t.elevationQueryCache;if(i!=null)return i}return this._currentTileCache==null&&(this._currentTileCache=new Lt(new qt(20971520))),this._currentTileCache}get _computations(){var e;return((e=this._computationsCollection)==null?void 0:e.toArray())??[]}get _activeComputations(){return this._computations.filter(e=>e.profile.enabled&&e.available)}get _minDemResolution(){const e=this._minDemResolutions;return e.length>0?Ae(e):null}get _minDemResolutions(){const e=[];for(const{minDemResolution:t}of this._activeComputations)t!=null&&e.push(t);return e}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:e,activeComputations:t,generationParameters:i}){this._abortUpdate(),e&&(i!=null?this._updateTask=Ue(async s=>{this.error=null;const n=t.filter(a=>!this._isComputationValid(a,i));try{if(!i.geometryIsValid)throw new Qe;const a=Ci({...i,providers:n},{signal:s});let o=!1;for await(const l of a){z(s),o||(this._clearInvalidResults(i),o=!0);for(let c=0;c<n.length;c++)n[c].setResult(l[c])}for(const l of n)this._parametersPerComputation.set(l,i)}catch(a){At(a),this._abortUpdate(),this.error=a instanceof ie?a:new ci,n.forEach(o=>{o.clearResult()})}}):this._clearResults())}_abortUpdate(){this._updateTask=Ut(this._updateTask)}_isComputationValid(e,t){return this._parametersPerComputation.has(e)&&this._parametersPerComputation.get(e)===t}_invalidateComputation(e){this._parametersPerComputation.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(const t of this._computations)this._isComputationValid(t,e)||(t.clearResult(),this._parametersPerComputation.delete(t))}_clearResults(){for(const e of this._computations)e.clearResult(),this._parametersPerComputation.delete(e)}};r([u({constructOnly:!0})],g.prototype,"analysis",void 0),r([u({constructOnly:!0})],g.prototype,"analysisViewData",void 0),r([u({constructOnly:!0})],g.prototype,"computationFactory",void 0),r([u({constructOnly:!0})],g.prototype,"view",void 0),r([u()],g.prototype,"error",void 0),r([u({readOnly:!0})],g.prototype,"effectiveDisplayUnits",null),r([u()],g.prototype,"progress",null),r([u()],g.prototype,"updating",null),r([u()],g.prototype,"results",null),r([u()],g.prototype,"statistics",null),r([u()],g.prototype,"hoveredPoints",null),r([u()],g.prototype,"_updateTask",void 0),r([u()],g.prototype,"_queue",void 0),r([u()],g.prototype,"_tileCache",null),r([u()],g.prototype,"_computationsCollection",void 0),r([u()],g.prototype,"_computations",null),r([u()],g.prototype,"_activeComputations",null),r([u({readOnly:!0})],g.prototype,"_minDemResolution",null),r([u()],g.prototype,"_minDemResolutions",null),r([u()],g.prototype,"_updateParameters",null),r([u()],g.prototype,"_generationParameters",null),r([u()],g.prototype,"elevationInfo",null),r([u()],g.prototype,"_options",null),g=r([x("esri.views.analysis.ElevationProfile.ElevationProfileController")],g);const Wi=new fe({...ze});function tt(e){var s;if(e==null)return null;if(Ft(e))return it(e);const t=e.tileInfo;if(t==null)return null;const i=(s=t.lods)==null?void 0:s.at(-1);return i==null?null:i.resolution*W(t.spatialReference)}function it(e){if(e==null)return null;const t=e.layers.items.map(Bi).filter(Ge);return Ae(t)??null}function Bi(e){return e&&"tileInfo"in e?tt(e):null}let N=class extends S{constructor(){super(...arguments),this.type="ground",this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=E(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),O),this._getStableGroundLayers=E(()=>{var t,i;return(i=(t=this._ground)==null?void 0:t.layers)==null?void 0:i.toArray()},O)}get minDemResolution(){return it(this._ground)}get available(){var t;return((t=this._ground)==null?void 0:t.layers.some(i=>i.visible))===!0}initialize(){this.addHandles([P(()=>this._queryElevationDependencies,()=>this.onInvalidate(this))])}async queryElevation(t,i){const s=this._queryElevationDependencies;if(s==null)throw new Error(`${this.declaredClass}: no dependencies`);const{ground:n}=s;if(n==null)throw new Error("No ground configured in the view");const a=await n.queryElevation(t,i),o=Q(t.spatialReference),l=Q(n.layers.at(0).spatialReference);if(o!==l){const c=a.geometry;c.points=c.points.map(([p,h,d])=>[p,h,d===i.noDataValue?d:d*l/o])}return a}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){var t,i;return(i=(t=this.controller.view)==null?void 0:t.map)==null?void 0:i.ground}};r([u()],N.prototype,"minDemResolution",null),r([u()],N.prototype,"available",null),r([u()],N.prototype,"_queryElevationDependencies",null),r([u()],N.prototype,"_ground",null),N=r([x("esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation")],N);let oe=class extends S{constructor(){super(...arguments),this.type="input",this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=E(()=>{const{view:t}=this.controller;if(!t)return null;const i=this._getStableElevationInfo();return{view:t,stationary:!this._requiresElevationAlignment||t.stationary,elevationInfo:i,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},O),this._getStableElevationInfo=E(()=>this.controller.elevationInfo,ae),this._getStableSpatialReference=E(()=>{var t;return(t=this.controller.view)==null?void 0:t.spatialReference},ae),this._getStableLayerIds=E(()=>{const{view:t}=this.controller;return t.type!=="3d"?[]:je(t)},O)}initialize(){const t=()=>this.onInvalidate(this);this.addHandles([P(()=>this._queryElevationDependencies,t,ue),this.controller.onElevationChange(t)])}async queryElevation(t,{noDataValue:i,signal:s}){const n=this._queryElevationDependencies;if(n==null)throw new Error(`${this.declaredClass}: no dependencies`);const{view:a,spatialReference:o}=n;if(this._requiresElevationAlignment&&a.type==="3d"&&o){const l=await Te.fromGeometry(t).project(o,s);if(!l)return{geometry:t,noDataValue:i};const c=a.elevationProvider;return l.coordinates.forEach(p=>{p.z=c.getElevation(p.x,p.y,0,o,"ground")??0}),{geometry:l.export(),noDataValue:i}}return{geometry:t,noDataValue:i}}get _requiresElevationAlignment(){var t;return((t=this.controller.elevationInfo)==null?void 0:t.mode)==="on-the-ground"&&this.controller.view.type==="3d"}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};r([u()],oe.prototype,"_queryElevationDependencies",null),oe=r([x("esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation")],oe);let te=class extends S{constructor(){super(...arguments),this.type="query",this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return tt(this.profile.source)}get available(){const{source:e}=this.profile;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(t=>t.visible))}initialize(){this.addHandles(P(()=>this.profile.source,()=>this.onInvalidate(this),ue))}queryElevation(e,t){if(!this.profile.source)throw new Error("No source configured for the elevation profile line");return this.profile.source.queryElevation(e,t)}};r([u({readOnly:!0})],te.prototype,"minDemResolution",null),r([u()],te.prototype,"available",null),te=r([x("esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation")],te);let I=class extends Z{constructor(e){super(e),this._sketchViewModels=new Le,this._updatingHandles=new jt,this._operationManager=new ai}initialize(){const{view:e}=this;this._graphicsLayer=new Nt({listMode:"hide",internal:!0}),this.addHandles([P(()=>({map:e.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:t,internalGraphicsLayer:i,state:s,geometryVisualizationVisible:n,visible:a})=>{Ki(t,i);const o=this.sketchGraphic;switch(o&&(o.visible=a),s){case"idle":case"reshaping-disabled":o&&!n&&(o.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case"reshaping":pe(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},R),P(()=>this._analysis.elevationInfo,t=>{this._graphicsLayer.elevationInfo=t},R)])}destroy(){var t;this._operationManager.destroy(),this._sketchViewModels.drain(i=>ne(i));const e=this._graphicsLayer;(t=this.view.map)==null||t.remove(e),e.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(e){e!==this._get("sketchGraphic")&&(this._set("sketchGraphic",e),this._updateAnalysisFromSketchGraphic())}get state(){const{visible:e,interactive:t}=this.analysisViewData;if(!e)return"idle";switch(this._operationManager.currentOperationType){case"place":return this._sketching?"sketching":"awaiting-sketch";case"pick-feature":return"picking";default:return this._analysis.geometry?t?"reshaping":"reshaping-disabled":"idle"}}get updating(){return this._sketchViewModels.some(e=>e.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(e=>e.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return Yi(this.view.type)}place(e){return this._operationManager.start("place",async t=>{const i=this._createSketchViewModel(),s=this._analysis.clone();this._ensureUpdatedSketchGraphic();const n=this.sketchGraphic,a=this._analysis.elevationInfo,o=ee(()=>{this.sketchGraphic===n&&(this._graphicsLayer.elevationInfo=a)}),l=i.on("create",c=>{switch(c.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=c.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case"active":this._updateAnalysisFromSketchGraphic();break;case"complete":this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),t.stop();break;case"cancel":t.stop()}});t.handles.push(l,ee(()=>(l.remove(),i.destroy(),this._sketchViewModels.remove(i),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?Qt(e)||s.equals(this._analysis)?t.reject():void t.resolve({}):(this._clear(),t.reject()))),o),this._graphicsLayer.elevationInfo=Xi,await this._updatingHandles.addPromise(pe(i.create("polyline")))},e)}async pickFeature(e){return this._operationManager.start("pick-feature",async t=>{const{view:i}=this;i.closePopup();let s=null;const n=o=>{o.defer(async()=>{s==null||s.abort(),s=Ue(async l=>{const{results:c}=await i.hitTest(o);z(l);let p=null;for(const h of c)if(h.type==="graphic"&&mi(h.graphic)&&!vi(h.graphic)){p=h.graphic;break}p?(o.preventDefault(),o.stopPropagation(),this.sketchGraphic=null,this._analysis.geometry=p.geometry,this._analysis.elevationInfo=new fe({...Bt(p)}),t.resolve({feature:p}),t.stop()):t.reject()}),await s.promise})},a=o=>{Yt(o)&&(t.reject(),t.stop())};t.handles.push(i.on("immediate-click",n,$e.TOOL),i.on("key-down",a,$e.TOOL),i.acquireCursor("crosshair","high"),ee(()=>{s==null||s.abort(),t.reject()})),i.focus()},e)}_startReshape(){const e=this._createSketchViewModel();return this._sketchViewModels.add(e),this._operationManager.start("reshape",async t=>{const i=()=>{const n=this._ensureUpdatedSketchGraphic();return n?this._updatingHandles.addPromise(e.update(n,{tool:"reshape"})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const s=e.on("update",n=>{this._updateAnalysisFromSketchGraphic(),n.state==="complete"&&(this.state==="reshaping"?pe(i()):t.resolve())});t.handles.push(s,ee(()=>{s.remove(),this._sketchViewModels.remove(e),e.destroy(),t.resolve()})),await i()})}_createSketchViewModel(){return new ri({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:"click",hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol})}_ensureUpdatedSketchGraphic(){const{geometry:e}=this._analysis;if(!e)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;const t=this.sketchGraphic??(this.sketchGraphic=new Wt({symbol:this._lineSymbol,geometry:e}));return t.geometry=e,this._addSketchGraphic(t),t}_addSketchGraphic(e){const{graphics:t}=this._graphicsLayer;t.includes(e)||t.add(e),t.length!==1&&t.removeMany(t.filter(i=>i!==e))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){var i;let e=(i=this.sketchGraphic)==null?void 0:i.geometry;ge(e)||(e=null);const t=this._analysis;t.geometry!==e&&(t.geometry=e)}};function Yi(e){if(e==="2d"){const t={type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5};return new Kt({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{...t,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],color:[0,0,0,255]},{...t,color:[255,255,255,255]}]}}})}return new Xt({color:[0,0,0,0]})}function Ki(e,t){t&&(t.removeFromParent(),e==null||e.add(t))}r([u({constructOnly:!0})],I.prototype,"analysisViewData",void 0),r([u({constructOnly:!0})],I.prototype,"view",void 0),r([u()],I.prototype,"sketchGraphic",null),r([u({nonNullable:!0})],I.prototype,"state",null),r([u()],I.prototype,"updating",null),r([u()],I.prototype,"_sketching",null),r([u()],I.prototype,"_analysis",null),r([u()],I.prototype,"_lineSymbol",null),I=r([x("esri.views.analysis.ElevationProfile.ElevationProfileTool")],I);const Xi=new fe({mode:"on-the-ground",offset:0});let b=class extends Jt{constructor(e){super(e),this.type="elevation-profile-view-3d",this.analysis=null,this.hoveredPosition=null}initialize(){const{analysis:e,view:t}=this;this._controller=new g({analysis:e,analysisViewData:this,view:t,computationFactory:{create:i=>{switch(i.profile.type){case"ground":return new N(i);case"input":return new oe(i);case"query":return new te(i);case"scene":return new T(i)}}}}),this._visualization=new K({view:t,analysisViewData:this}),this._sketchTool=new I({view:t,analysisViewData:this})}destroy(){var e,t,i;(e=this._controller)==null||e.destroy(),(t=this._visualization)==null||t.destroy(),(i=this._sketchTool)==null||i.destroy()}get effectiveDisplayUnits(){var e;return((e=this._controller)==null?void 0:e.effectiveDisplayUnits)??{distance:"meters",elevation:"meters"}}get error(){var e;return(e=this._controller)==null?void 0:e.error}get hoveredPoints(){var e;return((e=this._controller)==null?void 0:e.hoveredPoints)??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){var e;return((e=this._controller)==null?void 0:e.progress)??0}get results(){var e;return((e=this._controller)==null?void 0:e.results)??[]}get statistics(){var e;return(e=this._controller)==null?void 0:e.statistics}get updating(){var e,t,i;return((e=this._controller)==null?void 0:e.updating)===!0||((t=this._visualization)==null?void 0:t.updating)===!0||((i=this._sketchTool)==null?void 0:i.updating)===!0}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){var e;return(e=this._sketchTool)==null?void 0:e.sketchGraphic}get toolState(){var e;return((e=this._sketchTool)==null?void 0:e.state)??"idle"}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};r([u({readOnly:!0})],b.prototype,"type",void 0),r([u({constructOnly:!0,nonNullable:!0})],b.prototype,"analysis",void 0),r([u({readOnly:!0})],b.prototype,"effectiveDisplayUnits",null),r([u({readOnly:!0})],b.prototype,"error",null),r([u()],b.prototype,"hoveredPosition",void 0),r([u()],b.prototype,"hoveredPoints",null),r([u({readOnly:!0})],b.prototype,"progress",null),r([u({readOnly:!0})],b.prototype,"results",null),r([u({readOnly:!0})],b.prototype,"statistics",null),r([u({readOnly:!0})],b.prototype,"updating",null),r([u()],b.prototype,"sketchGraphic",null),r([u()],b.prototype,"toolState",null),r([u()],b.prototype,"_controller",void 0),r([u()],b.prototype,"_visualization",void 0),r([u()],b.prototype,"_sketchTool",void 0),b=r([x("esri.views.3d.analysis.ElevationProfileAnalysisView3D")],b);const Ks=b;export{Ks as default};
