import{K as f,N as w,_ as b,b as m,bz as y,bF as d,is as O,c2 as T,I as $,fr as A,bR as C,eh as _}from"./index-fmuX7-Nm.js";import{r as g}from"./InteractiveToolBase-BIxM2RV4.js";let p=class extends g{constructor(t){super(t)}initialize(){this.addHandles(f(()=>this.analysisViewData.visible,t=>this.visible=t,w))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};p=b([m("esri.views.interactive.AnalysisToolBase")],p);function j(t,e){t.interactive=!0;const{tool:s,view:i}=t;i.activeTool=s;let a=A(e,()=>{i.activeTool===s&&(i.activeTool=null)});return y(async n=>{await C(()=>{var o;return!((o=t.tool)!=null&&o.active)},n),a=_(a)},e)}function q(t,e){return f(()=>t.interactive,()=>D(t,e),w)}function D(t,e){t.interactive?R(t,e):h(t)}function R(t,e){h(t);const{view:s,analysis:i}=t,a=new e({view:s,analysis:i,analysisViewData:t});return t.tool=a,s.tools.add(a),a}function h(t){const{view:e,tool:s}=t;s!=null&&(e.tools.remove(s),t.tool=null)}function x(t,e){var a;const s=t.userOperation,i=y(async n=>{var v;if(s){const l=s.promise.catch(()=>{});s==null||s.abort(),await l,d(n)}const o=j(t,{signal:n}),u=(e==null?void 0:e.shouldRejectOnCancel)??(()=>!0),r=O([T(()=>t.tool,"cancel",()=>{u()&&o.abort()})]),{tool:c}=t;try{c&&(c.resetCreated(),(v=e==null?void 0:e.onToolActivated)==null||v.call(e,c)),await o.promise,d(n)}catch(l){if(n.aborted||!$(l)||u())throw l}finally{r==null||r.remove()}},{signal:(a=e==null?void 0:e.abortOptions)==null?void 0:a.signal});return t.userOperation=i,i.promise.finally(()=>{t.userOperation===i&&(t.userOperation=null)})}async function B(t,e){const s=t.analysis.clone();return await x(t,{abortOptions:e==null?void 0:e.placementOptions,onToolActivated:e==null?void 0:e.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:i}=t;return!i.valid||i.equals(s)}}),{}}export{B as d,h as f,q as m,p as o,x as y};
