import{aG as Ie,aH as De,eT as He,_ as x,m as O,a1 as ye,eU as ne,dP as oe,eV as ce,b as Fe,a5 as I,tP as Re,zt as Le,zu as Ge,zB as le,Au as de,zD as qe,zs as Ne,zF as Ee,zG as Ve,c as Je,zH as Ke,zM as Ze,Bc as Qe,zS as Ye,Bd as Xe,z$ as et,zZ as tt,a7 as ue,lx as rt,oL as xe,kx as Se,As as st,ee as C,eF as c,cG as it,qO as Ue,Be as Y,oQ as at,cm as ge,ac as h,wf as nt,ax as ot,Bf as ct,a9 as E,ab as f,sl as se,oT as H,jT as je,jV as D,cK as M,ed as Oe,e7 as lt,cI as w,dZ as z,oR as dt,y8 as ut,dz as P,Bg as X,Bh as gt,Bi as ht,eZ as pt,sn as Te,dy as v,jr as ft,ad as bt,K as mt,a as $t,eH as wt,x as T,eo as he,aa as V,cH as ee,ur as pe,rU as fe,f0 as Q,hc as be,m5 as me,Bj as $e,sp as we,y6 as _t}from"./index-DfdgIpb3.js";import{j as vt,g as Mt,u as _e,v as Ct,C as N,e as Pt,i as ve,n as ke,x as te,U as yt,S as Me,l as Rt,a as xt,c as St}from"./sliceToolConfig-D1Wg0cxA.js";import{o as Ut,p as jt,w as Ot,r as Tt,Y as kt,t as k}from"./ShadedColorMaterial.glsl-C8zQHy5M.js";import{f as ze}from"./DefaultLayouts-DHBwkSm8.js";import{i as zt}from"./TriangleMaterial-boqwYeey.js";import{m as G}from"./ColorMaterial.glsl-ONZSf4F8.js";let _=class extends Ie(De){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&this.width===e.width&&this.height===e.height&&He(this.position,e.position)}};x([O({type:["plane"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],_.prototype,"type",void 0),x([O({type:ye,json:{write:{isRequired:!0}}})],_.prototype,"position",void 0),x([O({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),ne(e=>oe.normalize(ce(e),0,!0))],_.prototype,"heading",void 0),x([O({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),ne(e=>oe.normalize(ce(e),0,!0))],_.prototype,"tilt",void 0),x([O({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],_.prototype,"width",void 0),x([O({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],_.prototype,"height",void 0),_=x([Fe("esri.analysis.SlicePlane")],_);const At=_,Wt=I(0,0,0,.04);function Bt({accentColor:e}){return Re(e,.5)}function It({accentColor:e}){return Re(e,.7)}function Ae(e){const t=new Le,{vertex:n,fragment:a,attributes:s,varyings:i}=t;return Ge(n,e),s.add("position","vec3"),s.add("uv0","vec2"),i.add("vUV","vec2"),n.main.add(le`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),a.uniforms.add(new de("backgroundColor",r=>r.backgroundColor),new de("gridColor",r=>r.gridColor),new qe("gridWidth",r=>r.gridWidth)).main.add(le`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}const Dt=Object.freeze(Object.defineProperty({__proto__:null,build:Ae},Symbol.toStringTag,{value:"Module"}));class Ht extends Ne{constructor(){super(...arguments),this.backgroundColor=I(1,0,0,.5),this.gridColor=I(0,1,0,.5),this.gridWidth=4}}class Ft extends Ee{constructor(t,n){super(t,n,new Ve(Dt,()=>Je(()=>Promise.resolve().then(()=>Xt),void 0)),ze.locations)}initializePipeline(){return Ke({blending:Qe,depthTest:{func:513},colorWrite:Ze})}}class Lt extends zt{constructor(t){super(t,qt),this.produces=new Map([[8,n=>Ye(n)]]),this._configuration=new Xe}get visible(){return!0}createGLMaterial(t){return new Gt(t)}createBufferWriter(){return new et(ze)}getConfiguration(){return this._configuration}}class Gt extends tt{constructor(t){super(t)}beginSlot(t){return this.getTechnique(Ft,t)}}class qt extends Ht{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}}class Nt extends Ut{constructor(t){super(t),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=I(1,0,0,1),this._backgroundColor=I(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){ue(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){ue(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new Lt(this._materialParameters)}destroyExternalResources(){this._material=null}forEachMaterial(t){t(this._material)}createGeometries(t){if(this._material!=null){const n=rt(this._material);t.addGeometry(n)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){var t;(t=this._material)==null||t.setParameters(this._materialParameters)}}function nr(e,t,n,a,s,i,r,o){return Et(t,r.worldUpAtPosition(e,c.get()),s,i,o.basis1,o.basis2),h(o.basis1,o.basis1,n),h(o.basis2,o.basis2,a),M(o.origin,e),Ue(o.basis2,o.basis1,o.origin,o.plane),o}function Et(e,t,n,a,s,i){const r=z(e,t),o=c.get(),l=c.get();switch(a===0?Math.abs(r)>Pt?1:2:a){case 2:{const u=Math.abs(r)<=ve?e:n.viewUp;v(o,u,t),M(l,t);break}case 1:v(o,n.viewUp,t),v(l,t,o);break;case 3:{const u=Math.abs(r)<=ve?t:n.viewUp;v(o,u,e),v(l,e,o);break}}const d=v(c.get(),o,l);z(d,n.viewForward)>0&&h(l,l,-1),P(s,o),P(i,l)}function Vt(e,t,n){const a=t.worldUpAtPosition(e.origin,c.get()),s=e.basis1,i=ae(e,a),r=Math.round(i/A)*A;return Y(e,r-i,s,n)}function or(e,t,n,a,s,i){const r=M(c.get(),s.origin);f(r,r,h(c.get(),s.basis1,e.direction[0]<0?1:-1)),f(r,r,h(c.get(),s.basis2,e.direction[1]<0?1:-1));const o=C(s.basis1),l=C(s.basis2),d=w(c.get(),n,r),u=w(c.get(),t,r);let g=0,b=0;if(Be(e)){const K=re(s),W=re(i);g=o-.5*e.direction[0]*z(s.basis1,u)/o,b=l-.5*e.direction[1]*z(s.basis2,u)/l;const F=W/K;g*=F,b*=F}const p=g+.5*e.direction[0]*z(s.basis1,d)/o,$=b+.5*e.direction[1]*z(s.basis2,d)/l,U=h(c.get(),s.basis1,p/o),y=h(c.get(),s.basis2,$/l);(p<=0||Ce(i.origin,U,a)<=_e)&&M(U,i.basis1),($<=0||Ce(i.origin,y,a)<=_e)&&M(y,i.basis2);const m=M(c.get(),r);return f(m,m,h(c.get(),U,e.direction[0]<0?-1:1)),f(m,m,h(c.get(),y,e.direction[1]<0?-1:1)),dt(m,U,y,i)}function cr(e,t){return Ct*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function lr(e,t,n,a){const s=v(c.get(),t,n);return v(s,s,t),Oe(e,s,a)}function dr(e,t){return Ot(e.basis1,e.basis2,e.origin,t)}function ur(e,t,n,a){const s=t.worldUpAtPosition(e.origin,c.get()),i=c.get();switch(n){case 1:M(i,s);break;case 2:M(i,e.basis1)}return Oe(e.origin,i,a)}function gr(e,t,n,a){const s=ie(n,2),i=H.get();ut(i,t,s.edge*Math.PI/2);const r=P(c.get(),s.basis);let o=h(c.get(),r,s.direction*a.computeScreenPixelSizeAt(s.position)*N);f(o,o,s.position);const l=a.projectToRenderScreen(o,X(c.get())),d=Jt(a,l);gt(a,l,q),P(q.direction,q.direction);const u=c.get();!d&&ht(n,q,u)&&(o=u),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=pt(o),d?e.state|=J:e.state&=~J}function Jt(e,t){if(t==null)return!1;const[n,a,s,i]=e.viewport,r=Math.min(s,i)/16;let o=!0;return t[0]<n+r?(t[0]=n+r,o=!1):t[0]>n+s-r&&(t[0]=n+s-r,o=!1),t[1]<a+r?(t[1]=a+r,o=!1):t[1]>a+i-r&&(t[1]=a+i-r,o=!1),o}function hr(e,t,n,a){const s=C(a.basis1),i=C(a.basis2),r=We(a),o=re(a),l=E(c.get(),0,0,0);f(l,h(c.get(),a.basis1,t.direction[0]),h(c.get(),a.basis2,t.direction[1])),f(l,a.origin,l);let d=0,u=1;if(Be(t))t.direction[0]===1&&t.direction[1]===-1?d=A:t.direction[0]===1&&t.direction[1]===1?d=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(d=3*Math.PI/2),u=o;else{const b=t.direction[0]!==0?1:2;d=b===1?A:0,u=(b===1?i:s)-r}const g=se(H.get(),d);je(g,g,E(c.get(),u,u,u)),D(g,n,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=l}function pr(e,t,n,a){const s=a.worldUpAtPosition(n.origin,c.get()),i=ie(n,0),r=se(H.get(),i.edge*Math.PI/2);Te(r,r,-ae(n,s)),D(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=i.position}function fr(e,t,n){const a=ie(n,1),s=se(H.get(),a.edge*Math.PI/2);Te(s,s,A),D(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position}function ie(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:f(c.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:f(c.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:w(c.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:w(c.get(),e.origin,e.basis2),edge:t}}}function Ce(e,t,n){const a=n.projectToRenderScreen(f(c.get(),e,t),X(c.get())),s=n.projectToRenderScreen(w(c.get(),e,t),X(c.get()));return a&&s?ft(w(a,a,s)):0}function We(e){const t=C(e.basis1),n=C(e.basis2);return Mt*Math.min(t,n)}function re(e){return We(e)}function Be(e){return e.direction[0]!==0&&e.direction[1]!==0}function br(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new jt({view:e,attached:!1,color:It(e.effectiveTheme),width:vt,renderOccluded:4,geometry:[t],isDecoration:!0})}function mr(e){return new Nt({view:e,attached:!1,backgroundColor:Wt,gridColor:Bt(e.effectiveTheme),gridWidth:4,renderOccluded:4,isDecoration:!0})}function $r(e,t,n,a=new At){if(e==null)return null;const{renderCoordsHelper:s}=t,i=s.fromRenderCoords(e.origin,new ye({spatialReference:t.spatialReference}));if(i==null)return null;const r=st(i,n);if(r==null)return null;a.position=r;const o=2*C(e.basis1),l=2*C(e.basis2),d=Se.renderUnitScaleFactor(t.spatialReference,n);a.width=o*d,a.height=l*d;const u=s.worldUpAtPosition(e.origin,c.get());return a.tilt=it(ae(e,u)),a.heading=s.headingAtPosition(e.origin,e.basis1)-90,a}function ae(e,t){return ct(t,e.basis2,e.basis1)+A}function Kt(e,t,n,a,s,i,r=xe()){return i.toRenderCoords(e,r.origin)?(i.worldBasisAtPosition(r.origin,0,r.basis1),i.worldBasisAtPosition(r.origin,1,r.basis2),Ue(r.basis2,r.basis1,r.origin,r.plane),Y(r,-ge(t),at(r),r),Y(r,ge(n),r.basis1,r),h(r.basis1,r.basis1,a/2),h(r.basis2,r.basis2,s/2),nt(r),r):(ot.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function wr(e,t){if((e==null?void 0:e.position)==null)return null;const n=Tt(e.position,t.spatialReference,t.elevationProvider);if(n==null)return null;const a=Se.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),s=e.width*a,i=e.height*a;return{position:n,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:i}}function _r(e,t,n,a=xe()){if(e==null)return null;const s=Kt(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return n.tiltEnabled||s==null||Vt(s,t.renderCoordsHelper,s),s}const S=16,J=32,q=lt(),A=Math.PI/2,vr=16,Mr=32;function Cr(e){return(e.type==="building-scene-3d"?e:null)!=null}let Pr=class extends kt{constructor(t,n){const a=new bt({width:1,renderOccluded:4,isDecoration:!0},t.state.isGlobal),s=new G({cullFace:2,renderOccluded:16,isDecoration:!0}),i=new G({cullFace:2,renderOccluded:16,isDecoration:!0}),r=new G({cullFace:2,renderOccluded:16,isDecoration:!0}),o=new G({writeDepth:!1,cullFace:1,renderOccluded:2,isDecoration:!0});super({view:t,...Zt({offsetMode:n,tubeMaterial:s,tipMaterial:i,capMaterial:r,outlineMaterial:o,calloutMaterial:a})}),this._themeHandle=mt(()=>t.effectiveTheme.accentColor,l=>{const d=wt(l),u=T.toUnitRGBA(l),g=T.toUnitRGBA(d),b=T.toUnitRGBA(T.blendColors(d,l,.4)),p=T.toUnitRGBA(T.blendColors(d,l,.14));a.setParameters({color:u}),s.setParameters({color:p}),i.setParameters({color:g}),r.setParameters({color:b}),o.setParameters({color:u})},$t)}destroy(){this._themeHandle.remove(),super.destroy()}};function Zt({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:a,outlineMaterial:s,calloutMaterial:i}){const r=e===0?N:0,o=[ee(r,0,-Me/2),ee(r,0,Me/2)],l=Yt(o),d=Pe({vertices:o,padding:0,materials:{tube:t,tip:n,cap:a}}),u=Pe({vertices:o,padding:yt,materials:{tube:s,tip:s,cap:s}}),g=he(i,[[r,0,0],[r-N,0,0]]),b=he(i,[[r,0,0],[r-N,0,0]]);return{renderObjects:[...d.normal.map(p=>new k(p,1|S)),...u.normal.map(p=>new k(p,1|S)),new k(g,1|S|J),...d.focused.map(p=>new k(p,2|S)),...u.focused.map(p=>new k(p,2|S)),new k(b,2|S|J)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:ke,state:S}}function Pe({vertices:e,padding:t,materials:n}){const a=s=>{const i=e.slice(),r=w(c.get(),i[0],i[1]);P(r,r);const o=w(c.get(),i[i.length-1],i[i.length-2]);if(P(o,o),t>0){const B=h(V(),o,-t);i[i.length-1]=f(B,B,i[i.length-1]);const j=h(V(),r,-t);i[0]=f(j,j,i[0])}const l=s?St:1,d=te*l,u=ke*l,g=pe(H.get());if(t>0){const B=d/4,j=E(c.get(),0,B,0),L=1+t/B;fe(g,g,j),je(g,g,E(c.get(),L,L,L)),fe(g,g,h(j,j,-1/L))}const b=pe(Q()),p=ee(0,1,0),$=be(Q(),me($e.get(),p,o));$[12]=i[i.length-1][0],$[13]=i[i.length-1][1],$[14]=i[i.length-1][2],D($,$,g);const U=n.tube,y=Qt(Rt*(s?xt:1)+t,i,U);y.transformation=b;const m=[y],K=n.tip,W=we(K,d,u,24,!1,!1,!0);W.transformation=$,m.push(W);const F=n.cap,Z=we(F,d,u,24,!1,!0,!1);Z.transformation=$,m.push(Z);const R=be(Q(),me($e.get(),p,r));return R[12]=i[0][0],R[13]=i[0][1],R[14]=i[0][2],D(R,R,g),m.push(W.instantiate({transformation:R})),m.push(Z.instantiate({transformation:R})),m};return{normal:a(!1),focused:a(!0)}}function Qt(e,t,n){const a=[];for(let i=0;i<12;i++){const r=i/12*2*Math.PI;a.push([Math.cos(r)*e,Math.sin(r)*e])}return _t(n,a,t,[],[],!1)}function Yt(e,t){const n=w(V(),e[e.length-1],e[e.length-2]);P(n,n),h(n,n,te),f(n,n,e[e.length-1]);{const a=w(V(),e[0],e[1]);return P(a,a),h(a,a,te),f(a,a,e[0]),[a,...e,n]}}const Xt=Object.freeze(Object.defineProperty({__proto__:null,build:Ae},Symbol.toStringTag,{value:"Module"}));export{vr as C,Cr as L,_r as R,J as S,wr as U,Pr as _,nr as a,Be as b,At as c,gr as d,fr as e,It as f,Wt as g,br as h,Bt as i,mr as j,Mr as k,hr as l,re as m,cr as n,lr as o,ur as r,dr as s,or as t,pr as u,$r as w,S as x};
