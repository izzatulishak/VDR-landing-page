import{_ as o,m as h,b as y,u as g,s as u,bF as P,$ as v}from"./index-J_1OuWkH.js";import{m as b}from"./DynamicLayerView3D-D_Pf9aVi.js";import{a as E}from"./ExportWMSImageParameters-BINSrya9.js";import{i as F}from"./timeSupport-BpRdmhPK.js";import"./SubView3D-DHs0xsPc.js";import"./ImageMaterial.glsl-Cr8FFCe9.js";import"./TriangleMaterial-DV6_c_gn.js";import"./DefaultLayouts-Din63gEn.js";import"./LayerView3D-CKPXHrvt.js";import"./LayerView-BQxD7VAv.js";import"./RefreshableLayerView-B7ayjoA6.js";import"./utils-a-JH_DpS.js";const I=r=>{const n=r;let t=class extends n{initialize(){this.exportImageParameters=new E({layer:this.layer})}destroy(){this.exportImageParameters=g(this.exportImageParameters)}get exportImageVersion(){var e;return(e=this.exportImageParameters)==null||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}get timeExtent(){var e;return F(this.layer,(e=this.view)==null?void 0:e.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,i){const{layer:a}=this;if(!e)throw new u("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:a});const{popupEnabled:p}=a;if(!p)throw new u("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:p});const m=this.createFetchPopupFeaturesQuery(e);if(!m)return[];const{extent:s,width:c,height:l,x:w,y:f}=m;if(!(s&&c&&l))throw new u("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:s,width:c,height:l});const x=await a.fetchFeatureInfo(s,c,l,w,f);return P(i),x}};return o([h()],t.prototype,"exportImageParameters",void 0),o([h({readOnly:!0})],t.prototype,"exportImageVersion",null),o([h()],t.prototype,"layer",void 0),o([h({readOnly:!0})],t.prototype,"timeExtent",null),t=o([y("esri.views.layers.WMSLayerView")],t),t};let d=class extends I(b){constructor(){super(...arguments),this.type="wms-3d"}initialize(){this.layer.serviceSupportsSpatialReference(this.view.spatialReference)||this.addResolvingPromise(Promise.reject(new u("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view"))),this._updatingHandles.add(()=>{var r;return(r=this.exportImageParameters)==null?void 0:r.version},()=>{this._updatingHandles.addPromise(this.refreshDebounced())})}createFetchPopupFeaturesQuery(r){const{subView:n}=this;if(n.type!=="draped")return null;const t=n.findExtentInfoAt(r),e=t.extent,i=new v(e[0],e[1],e[2],e[3],n.spatialReference),a=t.imageSize,p=a.width,m=a.height,s=i.width/p;return{extent:i,width:p,height:m,x:Math.round((r.x-i.xmin)/s),y:Math.round((i.ymax-r.y)/s)}}getFetchOptions(){return{timeExtent:this.timeExtent}}};d=o([y("esri.views.3d.layers.WMSLayerView3D")],d);const H=d;export{H as default};
