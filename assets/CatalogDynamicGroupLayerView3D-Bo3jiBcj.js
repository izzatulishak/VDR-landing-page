import{_ as r,m as d,b as $,O as v,el as U,is as H,f as O,ek as I,ax as C,cd as f}from"./index-BMCdo1DP.js";import{l as N}from"./LayerView3D-7Rzm6NIV.js";import{d as T}from"./LayerView-CTBH7N9G.js";const c=Symbol(),D=b=>{const F=b;let i=class extends F{constructor(...e){super(...e),this.layerViews=new v,this._debouncedUpdate=U(async()=>{const{layer:t,parent:s}=this,n=s==null?void 0:s.footprintLayerView;let o=[];const u=this._createQuery();if(u&&n){const{features:m}=await n.queryFeatures(u);this.suspended||(o=m.map(y=>t.acquireLayer(y)))}this.removeHandles(c),this.addHandles(o,c)})}get creatingLayerViews(){var e;return((e=this.view)==null?void 0:e.layerViewManager.isCreatingLayerViewsForLayer(this.layer))??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(e=>e.updating)}enableLayerUpdates(){return H([this._updatingHandles.addWhen(()=>{var e,t;return((t=(e=this.parent)==null?void 0:e.footprintLayerView)==null?void 0:t.dataUpdating)===!1},()=>this.updateLayers()),this._updatingHandles.add(()=>{var e,t,s,n,o;return[this.layer.maximumVisibleSublayers,(e=this.layer.parent)==null?void 0:e.orderBy,(s=(t=this.parent)==null?void 0:t.footprintLayerView)==null?void 0:s.filter,(o=(n=this.parent)==null?void 0:n.footprintLayerView)==null?void 0:o.timeExtent,this.suspended]},()=>this.updateLayers()),O(()=>this.removeHandles(c))])}updateLayers(){this.suspended?this.removeHandles(c):this._updatingHandles.addPromise(I(this._debouncedUpdate()).catch(e=>{C.getLogger(this).error(e)}))}_createQuery(){var g,V;const e=(g=this.parent)==null?void 0:g.footprintLayerView,t=(V=this.layer)==null?void 0:V.parent;if(!e||!t||t.destroyed)return null;const{layer:{maximumVisibleSublayers:s},view:{scale:n}}=this;if(!s)return null;const{itemTypeField:o,itemSourceField:u,itemNameField:m,minScaleField:y,maxScaleField:L,objectIdField:S,orderBy:w}=t,_=f(`${y} IS NULL OR ${n} <= ${y} OR ${y} = 0`,`${L} IS NULL OR ${n} >= ${L}`),l=w==null?void 0:w.find(h=>h.field&&!h.valueExpression),a=e.createQuery();if(a.returnGeometry=!1,a.num=s,a.outFields=[S,u,m],a.where=f(a.where,_),this.unsupportedItemTypes!=null){const h=`${o} NOT IN (${this.unsupportedItemTypes.map(x=>`'${x}'`)})`;a.where=f(a.where,h)}return l!=null&&l.field&&(a.orderByFields=[`${l.field} ${l.order==="descending"?"DESC":"ASC"}`],a.outFields.push(l.field)),a}};return r([d({readOnly:!0})],i.prototype,"creatingLayerViews",null),r([d()],i.prototype,"layer",void 0),r([d()],i.prototype,"layerViews",void 0),r([d({readOnly:!0})],i.prototype,"unsupportedItemTypes",void 0),r([d()],i.prototype,"parent",void 0),r([d({readOnly:!0})],i.prototype,"isUpdating",null),i=r([$("esri.views.layers.CatalogDynamicGroupLayerView")],i),i};let p=class extends D(N(T)){constructor(){super(...arguments),this.type="catalog-dynamic-group-3d",this.layerViews=new v}initialize(){this.addHandles([this.enableLayerUpdates()])}};r([d()],p.prototype,"layerViews",void 0),r([d()],p.prototype,"parent",void 0),r([d()],p.prototype,"view",void 0),p=r([$("esri.views.3d.layers.CatalogDynamicGroupLayerView3D")],p);const Q=p;export{Q as default};
