import{ax as N,lS as b}from"./index-C571AxL3.js";const k={CIMVectorMarker:{size:10},CIMPictureMarker:{size:10},CIMTextSymbol:{height:10},CIMSolidStroke:{width:4},CIMGradientStroke:{gradientSize:75,gradientType:"Discrete"},CIMHatchFill:{separation:4},CIMGradientFill:{gradientSize:75,gradientType:"Discrete",interval:5},CIMGeometricEffectRadial:{angle:0,length:5}},F=15.5,E=1024,I=()=>N.getLogger("esri.symbols.cim.rasterizingUtils");function L(e,a){e==null&&(e=[]);const t=a==="Butt",r=a==="Square",n=!t&&!r;e.length%2==1&&(e=[...e,...e]);const o=F,s=2*o;let l=0;for(const C of e)l+=C;const c=Math.round(l*o),i=new Float32Array(c*s),h=.5*o;let f=0,u=0,m=.5,d=!0;for(const C of e){for(f=u,u+=C*o;m<=u;){let M=.5;for(;M<s;){const S=(M-.5)*c+m-.5,p=n?(M-o)*(M-o):Math.abs(M-o);i[S]=d?t?Math.max(Math.max(f+h-m,p),Math.max(m-u+h,p)):p:n?Math.min((m-f)*(m-f)+p,(m-u)*(m-u)+p):r?Math.min(Math.max(m-f,p),Math.max(u-m,p)):Math.min(Math.max(m-f+h,p),Math.max(u+h-m,p)),M++}m++}d=!d}const y=i.length,w=new Uint8Array(4*y);for(let C=0;C<y;++C){const M=(n?Math.sqrt(i[C]):i[C])/o;b(M,w,4*C)}return[w,c,s]}let x;function P(e,a){const{colorRamp:t,gradientType:r}=a,n=R(t),o=t.type==="CIMFixedColorRamp";if(r==="Continuous"&&!o)return g(e,n);const s=a.interval??k.CIMGradientFill.interval;if(o)return g(e,v(n,s));const l=[];x??(x=document.createElement("canvas")),z(x,n,s,1,0);const c=x.getContext("2d").getImageData(0,0,s,1).data;for(let i=0,h=0;i<s;i++,h=4*i){const f=[c[h+0],c[h+1],c[h+2],c[h+3]];l.push({offset:i/s,color:f}),l.push({offset:(i+1)/s,color:f})}return g(e,l)}function R(e){const a=[];switch(e.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{e.type==="CIMPolarContinuousColorRamp"&&I().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const t=e;a.push({offset:0,color:[t.fromColor[0],t.fromColor[1],t.fromColor[2],t.fromColor[3]/255]}),a.push({offset:1,color:[t.toColor[0],t.toColor[1],t.toColor[2],t.toColor[3]/255]});break}case"CIMFixedColorRamp":{const t=e,r=1/(t.colors.length-1);let n=0;for(const o of t.colors)a.push({offset:n,color:[o[0],o[1],o[2],o[3]/255]}),n+=r;break}case"CIMMultipartColorRamp":{const t=e,r=t.weights.reduce((o,s)=>o+s,0);let n=0;for(let o=0;o<t.colorRamps.length;o++){const s=t.colorRamps[o],l=t.weights[o],c=R(s);for(const i of c)a.push({offset:(n+i.offset*l)/r,color:i.color});n+=l}break}default:I().error(`Color ramp "${e.type}" currently unsupported.`)}return a}function v(e,a){const t=[],r=(e.length-1)/(a-1);for(let n=0;n<a;n++){const o=e[Math.round(n*r)].color;t.push({offset:n/a,color:o}),t.push({offset:(n+1)/a,color:o})}return t}function g(e,a,t=0){for(const{offset:r,color:n}of a)e.addColorStop(Math.min(Math.max(r,t),1-t),`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`)}function z(e,a,t,r,n){const o=t+2*n;e.width=o,e.height=r;const s=(n+1)/o,l=e.getContext("2d",{willReadFrequently:!0});if(a.length>0){const c=l.createLinearGradient(0,0,o,r);g(c,a,s),l.fillStyle=c}else l.fillStyle="rgba(128, 128, 128, 1)";l.fillRect(0,0,o,r)}function G(e){var n,o,s,l;const a=((o=(n=e[0])==null?void 0:n[0])==null?void 0:o[0])??0,t=((l=(s=e[0])==null?void 0:s[0])==null?void 0:l[1])??0,r={ymin:t,xmin:a,ymax:t,xmax:a,width:0,height:0};for(let c=0;c<e.length;c++){const i=e[c];for(let h=0;h<i.length;h++){const f=i[h][0],u=i[h][1];f<r.xmin&&(r.xmin=f),f>r.xmax&&(r.xmax=f),u<r.ymin&&(r.ymin=u),u>r.ymax&&(r.ymax=u)}}return r.width=Math.abs(r.xmax-r.xmin),r.height=Math.abs(r.ymax-r.ymin),r}function $(e,a){const t=G(e),r=t.width===0?1:t.width,n=t.height===0?1:t.height,o=[];for(let s=0;s<e.length;s++){const l=e[s],c=[];for(let i=0;i<l.length;i++){let h=Math.round(l[i][0]-t.xmin),f=Math.round(l[i][1]-t.ymin);if(h=a.xmin+h*a.width/r,f=a.ymin+f*a.height/n,isNaN(h)||isNaN(f))throw new Error("Scaled shape has NaN values");c.push([h,f])}o.push(c)}return o}function q(e,a,t){const r=[];for(let n=0;n<e.length;n++){const o=e[n],s=[];for(let l=0;l<o.length;l++){const c=o[l][0]+a,i=o[l][1]+t;if(isNaN(c)||isNaN(i))throw new Error("Scaled shape has NaN values");s.push([c,i])}r.push(s)}return r}export{q as R,$ as T,k as o,P as p,E as r,L as u};
