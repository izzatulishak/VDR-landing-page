import{bJ as u,av as c,ce as m,bK as p,br as f,bq as y}from"./index-CG5kgmiA.js";import{t as v,r as P}from"./query-FqqeMovW.js";import{v as g}from"./PivotQuery-C3FyYlGd.js";import"./pbfQueryUtils-BAockODK.js";import"./pbf-qlg0P4gx.js";import"./queryZScale-DvOJNiO-.js";function l(i){const t=P(i),o=t.outPivots;if(o!=null&&o.length){for(const r of o)r.pivotType==="Pivot"&&r.pivotParameters.outStatistic?r.pivotParameters.outStatistic=JSON.stringify(r.pivotParameters.outStatistic):r.pivotType==="Unpivot"&&(r.unPivotParameters.sourceFields=r.unPivotParameters.sourceFields.join(","));t.outPivots=JSON.stringify(o)}return t}async function S(i,t,o){return await q(i,t,o)}async function q(i,t,o={}){const r=typeof i=="string"?u(i):i,a=t.geometry?[t.geometry]:[],e=await c(a,null,{signal:o.signal}),n=e==null?void 0:e[0];n!=null&&((t=t.clone()).geometry=n);const s=v({...r.query,f:"json",...l(t)});return m(p(r.path,"queryPivot"),{...o,query:{...s,...o.query}})}async function h(i,t,o){const r=f(i),a={...o},{data:e}=await S(r,g.from(t),a);return y.fromJSON(e)}export{h as executePivotQuery};
