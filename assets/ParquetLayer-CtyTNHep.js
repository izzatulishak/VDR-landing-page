import{mT as x,nA as F,nB as _,mU as I,kL as S,ax as c,bq as P,$ as q,i7 as T,bF as h,_ as r,m as i,b as $,nV as j,nW as R,nX as J,hF as N,nY as z,hX as E,hz as D,fD as L,fF as k,hA as C,aG as Q,L as U,l as V,O as d,K as g,kP as A,n_ as m,hV as G,s as H,nD as W,bs as f,n$ as B,aL as M,bd as X,bx as v,nF as K,o2 as Y,o0 as Z,o1 as ee,hH as te,nH as re,m_ as se,o3 as ie,by as ae,bw as oe}from"./index-J_1OuWkH.js";import{p as ne,i as le,s as ue,a as pe,c as y}from"./parquetUtils-BUu0nrxu.js";import"./locationUtils-BgRfjyOb.js";import"./parquet-ECAMYKTT.js";import"./QueueProcessor-CWIDO2Md.js";const ye=Symbol("isParquetGraphicOrigin");var b;class de extends x{get[(b=ye,F)](){return this.layer}get[_](){return this.layer}get[I](){return this.layer}constructor(t){super(),this[b]=!0,this.type="parquet",this.layer=t}get id(){return this.layer.id}}let u=class extends S{constructor(e){super(e),this.type="parquet"}load(e){const t=e!=null?e.signal:null;return this.addResolvingPromise(this._initialize(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.destroy()}setCustomParameters(e){this._proxy.setCustomParameters(e).catch(()=>{c.getLogger(this).warn("Failed to update customParameters")})}async updateFiles(e){await this._proxy.updateFiles(e)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._proxy.queryFeatures(e.toJSON(),{signal:t==null?void 0:t.signal})}async queryFeatures(e,t={}){const a=await this.queryFeaturesJSON(e,{signal:t==null?void 0:t.signal});return P.fromJSON(a)}async queryObjectIds(e,t){return await this._proxy.queryObjectIds(e.toJSON(),{signal:t==null?void 0:t.signal})}async queryFeatureCount(e,t){return this._proxy.queryFeatureCount(e.toJSON(),{signal:t==null?void 0:t.signal})}async queryExtent(e,t){if(this.layer.encoding==null)return c.getLogger(this).warn("Tried to queryExtent, but source does not have a geometry. Returning null extent."),{count:0,extent:null};const a=await this._proxy.queryExtent(e.toJSON(),{signal:t==null?void 0:t.signal});return{count:a.count,extent:q.fromJSON(a.extent)}}async _initialize(e){var o,n,l;this._connection=await T("ParquetSourceWorker",{strategy:"dedicated",signal:e,registryTarget:this}),h(e),this._proxy=this._connection.createInvokeProxy();const{layerDefinition:t,capabilities:a}=await this._proxy.load({urls:this.layer.urls.items,fields:(o=this.layer.fields)==null?void 0:o.map(p=>p.toJSON()),geometryType:this.layer.geometryType?ne(this.layer.geometryType):null,spatialReference:(n=this.layer.spatialReference)==null?void 0:n.toJSON(),encoding:(l=this.layer.encoding)==null?void 0:l.toJSON(),displayOptimization:this.layer.displayOptimization,customParameters:this.layer.customParameters});h(e),this.sourceJSON=t,this.capabilities=a}};r([i()],u.prototype,"type",void 0),r([i({constructOnly:!0})],u.prototype,"layer",void 0),r([i()],u.prototype,"sourceJSON",void 0),r([i()],u.prototype,"capabilities",void 0),u=r([$("esri.layers.graphics.sources.ParquetSource")],u);const w=K(),O="__OBJECTID",ce={types:{key:"type",base:pe,typeMap:{wkb:ue,location:le}},json:{name:"layerDefinition.geometryEncoding",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryEncoding"}}}}};let s=class extends j(R(J(N(z(E(D(L(k(C(Q(U))))))))))){constructor(e){super(e),this.copyright=null,this.displayOptimization=null,this.fields=null,this.fieldsIndex=null,this.encoding=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new de(this),this.labelsVisible=!0,this.labelingInfo=null,this.objectIdField=O,this.operationalLayerType="ParquetLayer",this.outFields=null,this.persistenceEnabled=!!V("parquetlayer-persistence-enabled"),this.popupTemplate=null,this.source=null,this.spatialReference=null,this.templates=null,this.title="Parquet",this.type="parquet",this.urls=new d}destroy(){var e;(e=this.source)==null||e.destroy()}async load(e){return this.addResolvingPromise(this._load(e)),this.addHandles([g(()=>this.urls,t=>{var a;return(a=this.source)==null?void 0:a.updateFiles(t.items)}),g(()=>this.customParameters,t=>{var a;return(a=this.source)==null?void 0:a.setCustomParameters(t)})]),this}get capabilities(){var e;return(e=this.source)==null?void 0:e.capabilities}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,a,o){const n=e.filter(l=>!(l.name===O&&l.type==="oid")).map(l=>l.toJSON(o));A(a,n,t)}get isTable(){return this.encoding==null}set renderer(e){m(e,this.fieldsIndex),this._set("renderer",e)}readUrls(e){return new d(e.type==="files"?e.urls:[])}writeUrls(e,t,a,o){var l;const n=[];if(e!=null&&e.length){o={blockedRelativeUrls:o==null?void 0:o.blockedRelativeUrls};for(let p of e)p=G(p,o),p&&n.push(p)}n.length?t.source={type:"files",urls:n}:(l=o.messages)==null||l.push(new H("parquet-layer:missing-urls","Missing or empty 'urls'",{layer:this}))}createPopupTemplate(e){return W(this,e)}createQuery(){const e=new f;return e.returnGeometry=!0,e.outFields=["*"],e}async createSource(e){const t=new u({layer:this});return await t.load(e),t}getFieldDomain(e,t){return null}getField(e){return this.fieldsIndex.get(e)}async queryFeatures(e,t){await this.load();const a=await this.source.queryFeatures(this._normalizeQuery(e),t),o=this.graphicOrigin;if(a!=null&&a.features)for(const n of a.features)n.layer=n.sourceLayer=this,n.origin=o;return a}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(this._normalizeQuery(e),t)}async queryFeatureCount(e,t){return await this.load(),this.source.queryFeatureCount(this._normalizeQuery(e),t)}async queryExtent(e,t){return await this.load(),this.source.queryExtent(this._normalizeQuery(e),t)}_normalizeQuery(e){return f.from(e)??this.createQuery()}async _load(e){const t=await this.createSource(e);this._set("source",t),this.read(t.sourceJSON,{origin:"service"}),this.revert(["fields","timeInfo"],"service"),m(this.renderer,this.fieldsIndex),B(this.timeInfo,this.fieldsIndex),this.spatialReference==null&&(this.spatialReference=M.WGS84)}};r([i({readOnly:!0,json:{read:!1,write:!1}})],s.prototype,"capabilities",null),r([i({type:String})],s.prototype,"copyright",void 0),r([i({readOnly:!0})],s.prototype,"defaultPopupTemplate",null),r([i()],s.prototype,"displayOptimization",void 0),r([i({type:[X],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],s.prototype,"fields",void 0),r([v("fields")],s.prototype,"writeFields",null),r([i(w.fieldsIndex)],s.prototype,"fieldsIndex",void 0),r([i(ce)],s.prototype,"encoding",void 0),r([i({type:q,json:{name:"extent"}})],s.prototype,"fullExtent",void 0),r([i({type:y.apiValues,json:{name:"layerDefinition.geometryType",read:{reader:y.read},write:{writer:y.write,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryType",reader:y.read}}}}})],s.prototype,"geometryType",void 0),r([i({readOnly:!0,clonable:!1})],s.prototype,"graphicOrigin",void 0),r([i(Y)],s.prototype,"labelsVisible",void 0),r([i({type:[ee],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:Z},write:!0}})],s.prototype,"labelingInfo",void 0),r([i(te)],s.prototype,"legendEnabled",void 0),r([i()],s.prototype,"file",void 0),r([i({type:String,readOnly:!0})],s.prototype,"objectIdField",void 0),r([i({type:["ParquetLayer"]})],s.prototype,"operationalLayerType",void 0),r([i(w.outFields)],s.prototype,"outFields",void 0),r([i(re)],s.prototype,"popupEnabled",void 0),r([i({type:se,json:{name:"popupInfo",write:!0}})],s.prototype,"popupTemplate",void 0),r([i({types:ie,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{read:{source:"drawingInfo.renderer"}}}}})],s.prototype,"renderer",null),r([i({type:u,readOnly:!0,cast:null,json:{read:!1}})],s.prototype,"source",void 0),r([i({json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"extent.spatialReference"}}}}})],s.prototype,"spatialReference",void 0),r([i({type:[ae]})],s.prototype,"templates",void 0),r([i()],s.prototype,"title",void 0),r([i({json:{read:!1},readOnly:!0})],s.prototype,"type",void 0),r([i({type:d.ofType(String),json:{name:"source",write:{isRequired:!0,ignoreOrigin:!0}}})],s.prototype,"urls",void 0),r([oe("urls")],s.prototype,"readUrls",null),r([v("urls")],s.prototype,"writeUrls",null),s=r([$("esri.layers.ParquetLayer")],s);const be=s;export{be as default};
