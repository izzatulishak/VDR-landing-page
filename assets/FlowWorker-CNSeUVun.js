import{_ as m,b as g}from"./index-gvPOfpe8.js";import{f as h,d as w}from"./dataUtils-CQynsu6c.js";import{x as _,f as D}from"./loadUtils-L9fOY7dS.js";import"./FeatureTileDescriptor-CPJ9qBU5.js";let c=class{constructor(){this._tileData=new Map}async generateStreamlines(i){const{flowData:o,flowExtentInfo:t,needsMagnitude:e,simulationSettings:l,startPositions:f}=i,r=d(h(l,o),l,t.modelSize,e,f);return{result:{streamlines:r},transferList:r==null?void 0:r.map(a=>a.vertices.buffer)}}async generateTiledStreamlines(i){const{flowDataTiles:o,flowExtentInfo:t,needsMagnitude:e,reset:l,simulationSettings:f,startPositions:r}=i;this._updateTileData(o,l);const a=d(_(f,this._tileData,t),f,t.modelSize,e,r);return{result:{streamlines:a},transferList:(a==null?void 0:a.map(n=>n.vertices.buffer))??[]}}_updateTileData(i,o){o&&this._tileData.forEach((t,e)=>{i.get(e)==null&&this._tileData.delete(e)}),i.forEach((t,e)=>{t.type==="delete"?this._tileData.delete(e):t.type!=="on-worker"&&t.type!=="waiting"&&this._tileData.set(e,t.data)})}};c=m([g("esri.views.3d.support.flow.FlowWorker")],c);const E=c;function d(i,o,t,e,l){if(i==null)return;const f=w(o,i,t[0],t[1],{positions:l}),r=[],a=D(e);for(const{vertices:n,stage:p}of f){const u=new Float32Array(n.length*a);for(let s=0;s<n.length;s++)u[s*a]=n[s].x,u[s*a+1]=n[s].y,u[s*a+2]=n[s].t,e&&(u[s*a+3]=n[s].speed);r.push({vertices:u,stage:p,hasMagnitude:e})}return r}export{E as default};
